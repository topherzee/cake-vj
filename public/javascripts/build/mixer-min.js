function Addon(){}function AudioAnalysis(e,n){var r=this;r.uuid="Analysis_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Addon",r.audio="",r.bypass=!1,r.bpm=128,r.beats=0,r.delayed_bpm=128,r.use_delay=!0,r.bpm_limit=256,r.bpm_float=0,r.mod=1,r.bps=1,r.sec=0,r.count=0,r.dataSet,r.tempoData,r.audio_src,r.options={audio:"/audio/fear_is_the_mind_killer_audio.mp3",microphone:!1},null!=n&&(r.options=n);var t=!0,o=[],u=0,c=(new Date).getTime();e.add(r);var a=new Audio;r.audio=a;var i,s=new(window.AudioContext||window.webkitAudioContext),l=s.createBiquadFilter(),d=s.createAnalyser(),m=Date.now();r.dataSet=new Array(4e3);var f,v=new Array(4e3),g=[],p=1,h=!1,_=[];a.controls=!0,a.loop=!0,a.autoplay=!0,a.crossorigin="anonymous",l.type="lowpass",l.frequency.value=350,l.Q.value=1,d.fftSize=128,f=d.frequencyBinCount,r.context=s,r.analyser=s,r.bufferLength=f,r.dataArray=void 0,r.disconnectOutput=function(){i.disconnect(s.destination)},r.connectOutput=function(){i.connect(s.destination)},r.getBpm=function(){return r.bpm};var y=function(){if(!r.audio.paused)return s.resume(),document.body.removeEventListener("click",y),void document.body.removeEventListener("touchstart",y);console.log("AudioAnalysis is re-intialized after click initialized!",a.src),s.resume().then(()=>{a.play(),console.log("Playback resumed successfully"),document.body.removeEventListener("click",y),document.body.removeEventListener("touchstart",y)})};document.body.addEventListener("click",y),document.body.addEventListener("touchstart",y),r.init=function(){console.log("init AudioAnalysis Addon."),r.options.microphone?(console.log("Audio analisis using microphone."),navigator.mediaDevices.getUserMedia({audio:a}).then(function(e){i=s.createMediaStreamSource(e),S(),r.disconnectOutput()}).catch(function(e){console.log(e.name+": "+e.message)})):(i=s.createMediaElementSource(a),a.src=r.options.audio,r.audio_src=r.options.audio,S())},r.render=function(){return r.bpm_float},r.add=function(e){o.push(e)},r.sync=function(){c=(new Date).getTime()},r.getBlackOut=function(){},r.getAmbience=function(){},r.getHighLevels=function(){},r.getMidLevels=function(){},r.getLowLevels=function(){};var b=0;r.update=function(){r.bypass||(r.disabled||o.forEach(function(e){e(r.render())}),r.bpm=r.tempodata_bpm,r.bpm>r.bpm_limit&&(console.warn("reached bpm limit!: ",r.bpm,"reset bpm to limit: ",r.bpm_limit),r.bpm=r.bpm_limit),u=((new Date).getTime()-c)/1e3,r.count=u,r.use_delay?(r.delayed_bpm<r.bpm&&(r.delayed_bpm+=.1),r.delayed_bpm>r.bpm&&(r.delayed_bpm-=.1)):r.delayed_bpm=r.bpm,r.sec=u*Math.PI*r.delayed_bpm/60,r.sec=r.sec*(b/r.delayed_bpm),r.bpm_float=(Math.sin(r.sec*r.mod)+1)/2,r.bpm!=b&&(b=r.delayed_bpm*r.mod),r.sec>r.delayed_bpm&&(c=(new Date).getTime()),r.bpm_float>.9&&!h?(r.beats+=1,h=!0):r.bpm_float<.1&&h&&(r.beats+=1,h=!1))};var S=function(){if(a.play(),i.connect(l),l.connect(d),i.connect(s.destination),window.Worker){console.log("go");var e=new Blob(['\n      \n        var _self = null;\n        onmessage = function(e) {\n          \n          var data = JSON.parse(e.data)\n          console.log("msgevent:", data.command );          \n          _self = data.module\n          if ( data.command == "start" ) {\n            //setInterval( worker_sampler, 1);\n            console.log("(TEST)start the worker!", _self)\n          }          \n        }\n\n        postMessage(\'Inline worker created\');          \n      ']),n=window.URL.createObjectURL(e),r=new Worker(n);r.onmessage=function(e){console.log("module got worker message: ",e.data)},window.my_worker=r,setInterval(w,1)}else setInterval(w,1)},x=!1,w=function(){if(!r.audio.muted&&!r.bypass){r.dataArray=new Uint8Array(f),d.getByteTimeDomainData(r.dataArray);var e=Date.now(),n=0;if(r.dataArray.forEach(e=>{e>n&&(n=e)}),r.dataSet.push([e,n]),r.dataSet.length>4e3&&r.dataSet.splice(0,r.dataSet.length-4e3),0,e-m>20){var t=U(r.dataSet);r.tempoData=t,null==t?(x||console.warn(" WARNING: sampler is active, but no audio was detected after 20 seconds -- check your audiofile or your microphone and make sure you've clicked in the window and gave it access! Halting."),x=!0,r.tempodata_bpm=128):(r.tempodata_bpm=t.bpm,x=!1),r.useAutoBPM&&(r.sec=u*Math.PI*(t.bpm*r.mod)/60),m=Date.now(),0}}},E=function(){0!=document.getElementsByClassName("blink").length&&(a.paused?document.getElementsByClassName("blink")[0].style.opacity=0:1==document.getElementsByClassName("blink")[0].style.opacity?document.getElementsByClassName("blink")[0].style.opacity=0:document.getElementsByClassName("blink")[0].style.opacity=1,setTimeout(E,60/r.bpm*1e3/r.mod))};E();var U=function(e){g=[],v=new Array(e.length);for(var n=0;n<e.length;n++)void 0!==e[n]&&e[n][1]>128*p&&(v[n]=[r.dataSet[n][0],1],g.push([e[n][0],1]),n+=50);g.length<15&&(p-=.05),g.length>60&&(p+=.05),p>2&&(p=2),p<1&&(p=1);var o=T(M(g));if(o.sort(C),0==o.length)o[0]={tempo:128};else{var u="";o.reverse().forEach(function(e,n){u+=n+", "+e.tempo+", "+e.count+"\t [";for(var r=0;r<e.count;)u+="#",r++;u+="]<br/>"}),null!=document.getElementById("info")&&(document.getElementById("info").html=u)}var c="calibrating";if(t=!1,void 0===e[0])t=!0,document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999999");else{if(t=!1,void 0===o[0]||void 0===o[1])return;var a=o[0].count-o[1].count;a<=2?(c="low",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#990000")):a>2&&a<=7?(c="average",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#999900")):a>7&&(c="high",document.getElementsByClassName("blink").length>0&&(document.getElementsByClassName("blink")[0].style.backgroundColor="#CCCCCC"))}return{bpm:o[0].tempo,confidence:c,calibrating:t,treshold:p,tempoCounts:o,foundpeaks:g,peaks:v}},C=function(e,n){return parseInt(e.count,10)-parseInt(n.count,10)},M=function(e){return _=[],e.forEach(function(n,r){for(var t=0;t<10;t++)if(void 0!==e[r+t]){var o=e[r+t][0]-n[0];_.some(function(e){if(e.interval===o)return e.count++})||_.push({interval:o,count:1})}}),_},T=function(e){var n=[];return e.forEach(function(e,r){if(0!=e.interval&&!isNaN(e.interval))var t=60/(e.interval/1e3);for(;t<90;)t*=2;for(;t>180;)t/=2;t=2*Math.round(t/2),n.some(function(n){if(n.tempo===t)return n.count+=e.count})||t&&n.push({tempo:t,count:e.count})}),n}}function BPM(e,n){var r=this;if(r.function_list=[["AUTO","method","toggleAutoBpm"],["MODDOWN","method","modDown"],["MODUP","method","modUp"],["MOD","method","modNum"]],null!=e){r.uuid="BPM_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),window["bpm_"+r.uuid],r.type="Addon",r.options={},null!=n&&(r.options=n),r.bpm=128,r.bps=2.133333,r.sec=0,r.bpm_float=.46875,r.mod=1,r.useAutoBpm=!1,r.tempodata_bpm=128,r.mute=!1,r.autoBpmData={},r.audio_src="",r.useMicrophone=!1,r.bypass=!1;var t=[],o=0;e.add(r),r.init=function(){console.log("init BPM contoller.")};var u=(new Date).getTime();r.update=function(){r.bypass||(r.disabled||t.forEach(function(e){e(r.render())}),o=((new Date).getTime()-u)/1e3,r.sec=o*Math.PI*(r.bpm*r.mod)/60,r.bpm_float=(Math.sin(r.sec)+1)/2)},r.add=function(e){t.push(e)},r.render=function(){return r.bpm_float},r.modUp=function(){r.mod*=2},r.modDown=function(){r.mod*=.5},r.modNum=function(e){console.log("MOD ",e);var n=r.useAutoBpm;r.mod=e,r.useAutoBpm=n},r.toggleAutoBpm=function(e){r.useAutoBpm=!r.useAutoBpm,console.log("---\x3e",r.useAutoBpm)},r.turnOff=function(){bpm.audio.muted=!1,bpm.useAutoBpm=!1};var c=Number(new Date),a=[128,128,128,128,128],i=0,s=0;r.tap=function(){r.useAutoBPM=!1,i=Number(new Date)-c,c=Number(new Date),i<1e4&&i>10&&(a.splice(0,1),a.push(6e4/i),s=a.reduce(function(e,n){return e+n})/a.length,r.bpm=s,r.bps=s/60)},r.getBpm=function(){return r.bpm},console.log("set keypress"),window.addEventListener("keypress",function(e){console.log(">>> ",e.which),116!=e.which&&32!=e.which||(r.tap(),console.log(r.bpm))})}}function FileManager(e){console.log("FileManager START ----------------");var n=this;n.function_list=[["CHZ","method","changez"]],n.uuid="Filemanager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="AddOn",n.defaultQuality="",n.source=e,n.debug=!1,n.set=[],n.load_set=function(e){console.log("FileManager load_set ----------------"),(new Utils).get(e,function(e){n.set=JSON.parse(e)})},null!=window.in_app&&(n.eu=window.eu),n.setSrc=function(e){null==window.in_app?(n.source.src(e),console.log("filemanager: set normal source:",e)):(n.source.src(n.eu.check_file(e)),console.log("filemanager: set checked source:",n.eu.check_file(e)))},n.load=function(e){(new Utils).get(e,function(e){n.set=JSON.parse(e),(n.debug=!1)&&console.log("got set: ",n.set)})},n.changeToNum=function(e){n.setSrc(n.set[e]),(n.debug=!1)&&console.log("changed file: ",e,self.set[e])},n.changeToUrl=function(e){n.setSrc(e),(n.debug=!1)&&console.log("changed file from url: ",_num,self.set[_num])},n.change=function(e){if(console.log("FileManager Change ----------------"),0!=n.set.length){if(null!=e)return void n.changeToNum(e);var r=n.set[Math.floor(Math.random()*n.set.length)];n.setSrc(r),(n.debug=!1)&&console.log("changed file: ",r)}},n.changez=function(e){n.change(e)},n.getSrcByTag=function(e){}}function GiphyManager(e){var n=this;n.uuid="GiphyManager_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="AddOn",n.source=e,n.file="",n.programs=[],n.program="";n.needle=function(e,r){(new Utils).get("//api.giphy.com/v1/gifs/search?api_key=tIovPHdiZhUF3w0UC6ETdEzjYOaFZQFu&q="+e,function(e){console.log(" === GIPHY (re)LOADED === "),n.programs=JSON.parse(e).data,null!=r&&r()})},n.search=function(e,r){n.needle(e,r)},n.setSrc=function(e){console.log("set source: ",e),n.source.src(e)},n.change=function(){if(0==n.programs.length)return"no programs found :(";n.program=n.programs[Math.floor(Math.random()*n.programs.length)],n.file=n.program,n.setSrc(n.program.images.original.url)},n.changez=function(){n.change()}}function Behaviour(e,n){var r=this;function t(e){"seconds"==e.mod.type?triggers.push([e,r.time+e.mod.value,null]):"beats"==e.mod.type?triggers.push([e,r.beats+e.mod.value]):"random-seconds"==e.mod.type?triggers.push([e,r.time+Math.random()*e.mod.value,null]):"random-beats"==e.mod.type&&triggers.push([e,r.beats+Math.random()*e.mod.value])}r.uuid="Behaviour"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Behaviour",e.add(r),r.beats=0,r.time=(new Date).getTime(),r.script={},r.sheets=[],r.sheet_index=0,r.bpm=n.bpm,triggers=[],r.tr=triggers,old_bpm=1,r.init=function(){},r.update=function(){r.time=(new Date).getTime();var e=Math.round(4*bpm.render());e!=old_bpm&&(r.beats+=1,old_bpm=e)},r.load=function(e){r.script=e,r.sheets=e.sheets,console.log("loaded A BEHAVIOUR",e.title),e.triggers.forEach(function(e,n){t(e)})},r.jump=function(e){console.log("how high?",e),e.video.currentTime=Math.random()*e.video.duration};var o=0;r.checkSheets=function(){r.sheets[0].length;checkBeats(o%r.sheets[r.sheet_index].length),r.sheets[r.sheet_index][o%r.sheets[r.sheet_index].length].forEach(function(e){if("....."!=e[0]){console.log(e);var n=r.script.composition[e[0]].target,t=r.script.composition[e[0]].functions,o=null;t.forEach(function(r,t){if(e[1]==r[0]){console.log("TRIGGERED",o=r[2]);var u=e[2];u=isNaN(e[2])?e[2]:parseFloat(e[2]),n[r[2]](u),console.log(n,o,u)}})}}),o+=1,setTimeout(r.checkSheets,60/bpm.bpm*1e3/4)};setTimeout(function(){},12e3)}function Controller(e){this.type="Controller",this.testControllerVar="test",this.init=function(){},this.update=function(){},this.render=function(){}}function GamePadController(e,n){var r=this;r.uuid="GamePadController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Control",r.controllers={},r.gamepad={},r.bypass=!0,r.debug=!1,r.gamepad_index=0,e.add(r);r.connect=function(){console.log("start gamepads"),window.addEventListener("gamepadconnected",function(e){console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.gamepad.index,e.gamepad.id,e.gamepad.buttons.length,e.gamepad.axes.length),r.init()}),window.addEventListener("gamepaddisconnected",function(e){console.log("Gamepad disconnected from index %d: %s",e.gamepad.index,e.gamepad.id)}),r.bypass=!1},r.init=function(){console.log("init GamePadController."),setTimeout(function(){try{r.connect()}catch(e){console.log("Initial connect failed, hope somebody presses the button v14 ",r,e)}},1200)},r.update=function(){if(!r.bypass){if(r.debug&&console.log(navigator.getGamepads()[0].axes),r.debug&&console.log(navigator.getGamepads()[0].buttons),void 0===navigator.getGamepads()[r.gamepad_index]||null===navigator.getGamepads()[0])return console.log("Gamepad: No gamepad could be found"),void(r.bypass=!0);navigator.getGamepads()[r.gamepad_index].axes.forEach(function(e,n){o([n+100,e])}),navigator.getGamepads()[r.gamepad_index].buttons.forEach(function(e,n){e.pressed&&(r.debug&&console.log(" Button: ",n,e.value,e),o([n,e.value]))})}},r.render=function(){return r.controllers};var t=[];self.removeEventListener=function(){},r.addEventListener=function(e,n){t.push({target:e,callback:n}),console.log("Gamepad listeners: ",t)};var o=function(e){t.forEach(function(n,r){e[0]==n.target&&n.callback(e)})};r.getNodes=function(){return t}}function KeyboardController(e,n){var r=this;r.uuid="KeyboardController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Control",r.controllers={},r.keyboard={},r.bypass=!0,r.debug=!1,e.add(r);r.init=function(){console.log("init KeyboardController."),document.addEventListener("keydown",e=>{r.debug&&console.log(" down ",[e.keyCode,1]),o([e.keyCode,1])}),document.addEventListener("keyup",e=>{r.debug&&console.log(" up ",[e.keyCode,0]),o([e.keyCode,0])})},r.update=function(){r.bypass},r.render=function(){return r.controllers};var t=[];self.removeEventListener=function(){},r.addEventListener=function(e,n){t.push({target:e,callback:n}),console.log("Keyboard listeners: ",t)};var o=function(e){t.forEach(function(n,r){e[0]==n.target&&n.callback(e)})};r.getNodes=function(){return t}}function MidiController(e){var n=this;n.uuid="MidiController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="MidiController",n.bypass=!0,n.debug=!1,n.ready=!1,n.controllers={};var r,t,u=[];console.log("Midi check... "),navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then(function(e){var u=(r=e).inputs.values(),c=r.outputs.values();for(i=u.next();i&&!i.done;i=u.next())i.value.onmidimessage=n.onMIDIMessage;for(o=c.next();o&&!o.done;o=c.next())t=o.value;console.log("Midi READY? ",t,r),null!=t&&(n.ready=!0),null!=t&&(n.bypass=!1)},function(e){console.error("No access to your midi devices.",e)});n.onMIDIMessage=function(e){n.debug&&console.log(" MIDIMESSAGE >>",e.data),c(e)},n.init=function(){},n.update=function(){},n.send=function(e){n.ready?(console.log("Midi send ",e,"to",t),t.send(e)):console.log("Midi is not ready yet")},n.clear=function(){for(var e=[],n=0;n++;n<100)e.push(144,n,0);t.send(e)},self.removeEventListener=function(e){u.forEach(function(n,r){if(n.target==e);}),u.splice(i,1)},n.addEventListener=function(e,n){u.push({target:e,callback:n}),console.log("MIDI listeners: ",u)};var c=function(e){u.forEach(function(n){n.target==e.data[1]&&n.callback(e.data)})}}function SocketController(e){var n=this;n.io=io.connect(),n.uuid="SocketController_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),n.type="Control",n.bypass=!0,n.title="",n.debug=!1,n.socket_pairing_id="no_paring_id",n.target="";var r=[];e&&"title"in e&&(n.title=e.title),n.io.on("test",function(e){console.log("got test",e)}),n.io.on("command",function(e){console.log("got command",e),"welcome"==e.command&&(n.target=e.payload,r.forEach(function(n,r){"welcome"!=n.target&&"ready"!=n.target||n.callback(e.payload)})),"reset_uuid"==e.command&&(console.log("reset uuid",e.payload),n.target=e.payload,r.forEach(function(n,r){"reset_uuid"!=n.target&&"reset"!=n.target||n.callback(e.payload)})),document.getElementById("sockets")&&(document.getElementById("sockets").innerHTML+="<div>"+n.title+" Socket: "+n.target+"</div>")}),n.io.on("controller",function(e){n.debug&&console.log("got controller",e),r.forEach(function(r,t){n.debug&&console.log("find node",t,r,e,n.target),e.client==n.target&&r.target==e.trigger&&(n.debug&&console.log("execute callback!"),r.callback(e.commands))})}),n.send=function(e,r,t){n.debug&&console.log("Socket send to: ",e,", trigger:",r," commands ",t),n.io.emit("controller",{client:e,trigger:r,commands:t})},self.removeEventListener=function(e){r.forEach(function(n,r){if(n.target==e);}),r.splice(i,1)},n.addEventListener=function(e,n){r.push({target:e,callback:n}),console.log("Socket listeners: ",r)}}function SourceControl(e,n){}function Effect(e,n){this.type="Effect",this.init=function(){},this.update=function(){},this.render=function(){}}function ColorEffect(e,n){var r=this;null==n.uuid?r.uuid="ColorEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,e.add(r),r.type="Effect",r.debug=!1;var t=n.source,o=1;null!=n.effect&&(o=n.effect);var u=.8;null!=n.extra&&(u=n.currentExtra),r.init=function(){console.log("ColorEffect init"),e.customUniforms[r.uuid+"_currentcoloreffect"]={type:"i",value:o},e.customUniforms[r.uuid+"_extra"]={type:"f",value:u},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+r.uuid+"_currentcoloreffect;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==renderer.fragmentShader.indexOf("vec4 coloreffect ( vec4 src, int currentcoloreffect, float extra, vec2 vUv )")&&(console.log("ColorEffect REPLACE"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\n/*\nfloat rand ( float seed ) {\n  return fract(sin(dot(vec2(seed) ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec2 displace(vec2 co, float seed, float seed2) {\n  vec2 shift = vec2(0);\n  if (rand(seed) > 0.5) {\n      shift += 0.1 * vec2(2. * (0.5 - rand(seed2)));\n  }\n  if (rand(seed2) > 0.6) {\n      if (co.y > 0.5) {\n          shift.x *= rand(seed2 * seed);\n      }\n  }\n  return shift;\n}\n\nvec4 interlace(vec2 co, vec4 col) {\n  if (int(co.y) % 3 == 0) {\n      return col * ((sin(time * 4.) * 0.1) + 0.75) + (rand(time) * 0.05);\n  }\n  return col;\n}\n*/\n\nbool mask_circle(vec2 uv, float radius, float x, float y){\n    \n  uv.x *= 1.6; \n  // uv.y *= 0.75;\n  float len = sqrt(pow((uv.x - x),2.0) + pow(uv.y - y,2.0));\n  if(len < radius){\n    return true;\n  }\n  return false;\n}\n\nvec4 coloreffect ( vec4 src, int currentcoloreffect, float extra, vec2 vUv ) {\n  if ( currentcoloreffect == 1 ) return vec4( src.rgba );                                                                                              // normal\n\n\n  //toph lum\n  if ( currentcoloreffect == 100 ) {\n    float brightness = (src.r + src.g + src.b) / 3.0 / 3.0;\n\n    float alpha = .0;\n    if (extra < brightness){\n      alpha = 1.0;\n    }\n    return vec4( src.r, src.g, src.b, alpha );\n  }\n\n\n  // toph circle mask\n  if ( currentcoloreffect == 101 ) {\n    \n    // gl_FragCoord.xy; is 640x480\n    // u_resolution.xy is 640x480\n    /* vec2 uv = gl_FragCoord.xy; */\n    //vec2 uv = gl_FragCoord.xy/u_resolution.xy - 0.5; // 0 to 1\n    /* uv.x *= u_resolution.x/u_resolution.y; */\n\n    // return src;\n\n    // vec2 uv = vUv.xy;\n    vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5);\n    float radius = 0.2;\n    float x = -0.2;\n    float y = +0.0;\n    float scale = 4.0;\n\n    if(mask_circle(uv, radius, x, y)  || mask_circle(uv, radius, -x, y)) {\n      gl_FragColor = src;\n    }else{\n    \tgl_FragColor = vec4(0.0, 0.0, 0.3, 1.0);\t\n    }\n\n\n\n    return gl_FragColor;\n  }\n\n  // negative\n  // negative 3 (reversed channel)\n  if ( currentcoloreffect == 2  ) return vec4( 1.-src.r, 1.-src.g, 1.-src.b, src.a );\n  // negative 3 (inverted channel high)\n  if ( currentcoloreffect == 3  ) return vec4( 1./src.r-1.0, 1./src.g-1.0, 1./src.b-1.0, src.a );\n  // negative 3 (inverted channel, low)\n  if ( currentcoloreffect == 4  ) return vec4( 1./src.r-2.0, 1./src.g-2.0, 1./src.b-2.0, src.a );\n  // negative 4 (inverted colors, inverted bw )\n  if ( currentcoloreffect == 5  ) return vec4( src.g + src.b / 2., src.r + src.b / 2., src.r + src.b / 2., src.a );\n  // negative 5 (normal colors, inverted b/w)\n  if ( currentcoloreffect == 6  ) return vec4( ( (src.r/2.) + ( ( ( (vec3( src.r + src.g + src.b ) / 3.) * -1.) + 1. ).r) ), ( (src.g/2.) + (( ( (vec3( src.r + src.g + src.b ) / 3.) * -1.) + 1. ).g) ), ( (src.b/2.) + ( ( ( (vec3( src.r + src.g + src.b ) / 3.) * -1.) + 1. ).b) ), src.a );\n\n  // monocolor\n  if ( currentcoloreffect == 10 ) return vec4( vec3( src.r + src.g + src.b ) / 3., src.a );                                                            // black and white\n  if ( currentcoloreffect == 11 ) return vec4( vec3( (src.r+src.g+src.b) *3.  , (src.r+src.g+src.b)  /1.7 , (src.r+src.g+src.b) /1.7 ) / 3., src.a );  // mopnocolor red\n  if ( currentcoloreffect == 12 ) return vec4( vec3( (src.r+src.g+src.b) /1.7 , (src.r+src.g+src.b)  *3.  , (src.r+src.g+src.b) /1.7 ) / 3., src.a );  // mopnocolor blue\n  if ( currentcoloreffect == 13 ) return vec4( vec3( (src.r+src.g+src.b) /1.7 , (src.r+src.g+src.b)  /1.7 , (src.r+src.g+src.b) *3.  ) / 3., src.a );  // mopnocolor green\n  if ( currentcoloreffect == 14 ) return vec4( vec3( (src.r+src.g+src.b) *2.  , (src.r+src.g+src.b)  *2.  , (src.r+src.g+src.b) /1.2 ) / 3., src.a );  // mopnocolor yellow\n  if ( currentcoloreffect == 15 ) return vec4( vec3( (src.r+src.g+src.b) *1.2 , (src.r+src.g+src.b)  *2.  , (src.r+src.g+src.b) *2.  ) / 3., src.a );  // mopnocolor turqoise\n  if ( currentcoloreffect == 16 ) return vec4( vec3( (src.r+src.g+src.b) *2.  , (src.r+src.g+src.b)  /1.2 , (src.r+src.g+src.b) *2.  ) / 3., src.a );  // mopnocolor purple\n  if ( currentcoloreffect == 17 ) return vec4( vec3( src.r + src.g + src.b ) / 3. * vec3( 1.2, 1.0, 0.8 ), src.a);                                     // sepia\n\n  // color swapping\n  if ( currentcoloreffect == 20 ) return vec4( src.rrra );\n  if ( currentcoloreffect == 21 ) return vec4( src.rrga );\n  if ( currentcoloreffect == 22 ) return vec4( src.rrba );\n  if ( currentcoloreffect == 23 ) return vec4( src.rgra );\n  if ( currentcoloreffect == 24 ) return vec4( src.rgga );\n  if ( currentcoloreffect == 25 ) return vec4( src.rbra );\n  if ( currentcoloreffect == 26 ) return vec4( src.rbga );\n  if ( currentcoloreffect == 27 ) return vec4( src.rbba );\n  if ( currentcoloreffect == 28 ) return vec4( src.grra );\n  if ( currentcoloreffect == 29 ) return vec4( src.grga );\n  if ( currentcoloreffect == 30 ) return vec4( src.grba );\n  if ( currentcoloreffect == 31 ) return vec4( src.ggra );\n  if ( currentcoloreffect == 32 ) return vec4( src.ggga );\n  if ( currentcoloreffect == 33 ) return vec4( src.ggba );\n  if ( currentcoloreffect == 34 ) return vec4( src.gbra );\n  if ( currentcoloreffect == 35 ) return vec4( src.gbga );\n  if ( currentcoloreffect == 36 ) return vec4( src.gbba );\n  if ( currentcoloreffect == 37 ) return vec4( src.brra );\n  if ( currentcoloreffect == 38 ) return vec4( src.brga );\n  if ( currentcoloreffect == 39 ) return vec4( src.brba );\n  if ( currentcoloreffect == 40 ) return vec4( src.bgra );\n  if ( currentcoloreffect == 41 ) return vec4( src.bgga );\n  if ( currentcoloreffect == 42 ) return vec4( src.bgba );\n  if ( currentcoloreffect == 43 ) return vec4( src.bbra );\n  if ( currentcoloreffect == 44 ) return vec4( src.bbga );\n  if ( currentcoloreffect == 45 ) return vec4( src.bbba );\n\n  // lum key\n  if ( currentcoloreffect == 50 ) {\n    float red = clamp( src.r, extra, 1.) == extra ? .0 : src.r;\n    float green = clamp( src.g, extra, 1.) == extra ? .0 : src.g;\n    float blue = clamp( src.b, extra, 1.) == extra ? .0 : src.b;\n    float alpha = red + green + blue == .0 ? .0 : src.a;\n    return vec4( red, green, blue, alpha );\n  }\n\n\n\n  // color key; Greenkey\n  if ( currentcoloreffect == 51 ) {\n    return vec4( src.r, clamp( src.r, extra, 1.) == extra ? .0 : src.g, src.b, clamp( src.r, extra, 1.) == extra ? .0 : src.a );\n  }\n\n  // paint\n  if ( currentcoloreffect == 52 ) {\n    // return vec4( floor( src.r * extra ) / extra, floor( src.g * extra ) / extra, floor( src.b * extra ) / extra, src.a  );\n    // devide the image up in color bars\n    vec4 pnt = vec4(\n      src.x < .1 ? .1 : src.x < .2 ? .2 : src.x < .3 ? .3 : src.x < .4 ? .4 : src.x < .5 ? .5 : src.x < .6 ? .6 : src.x < .7 ? .7 : src.x < .8 ? .8 : src.x < .9 ? .9 : src.x,\n      src.y < .1 ? .1 : src.y < .2 ? .2 : src.y < .3 ? .3 : src.y < .4 ? .4 : src.y < .5 ? .5 : src.y < .6 ? .6 : src.y < .7 ? .7 : src.y < .8 ? .8 : src.y < .9 ? .9 : src.y,\n      src.z < .1 ? .1 : src.z < .2 ? .2 : src.z < .3 ? .3 : src.z < .4 ? .4 : src.z < .5 ? .5 : src.z < .6 ? .6 : src.z < .7 ? .7 : src.z < .8 ? .8 : src.z < .9 ? .9 : src.z,\n      src.a\n    );\n\n    return pnt;\n  }\n\n  // colorise\n  if ( currentcoloreffect == 53 ) {\n\n    // TODO: mix paint and colorize together?\n\n    // devide the image up in color bars\n    vec4 pnt = vec4(\n      src.x < .1 ? .1 : src.x < .2 ? .2 : src.x < .3 ? .3 : src.x < .4 ? .4 : src.x < .5 ? .5 : src.x < .6 ? .6 : src.x < .7 ? .7 : src.x < .8 ? .8 : src.x < .9 ? .9 : src.x,\n      src.y < .1 ? .1 : src.y < .2 ? .2 : src.y < .3 ? .3 : src.y < .4 ? .4 : src.y < .5 ? .5 : src.y < .6 ? .6 : src.y < .7 ? .7 : src.y < .8 ? .8 : src.y < .9 ? .9 : src.y,\n      src.z < .1 ? .1 : src.z < .2 ? .2 : src.z < .3 ? .3 : src.z < .4 ? .4 : src.z < .5 ? .5 : src.z < .6 ? .6 : src.z < .7 ? .7 : src.z < .8 ? .8 : src.z < .9 ? .9 : src.z,\n      src.a\n    );\n\n    // colorize effect, fill the colors with random values\n    ( pnt.r == .1 || pnt.g == .1 || pnt.b == .1 ) ? pnt.rgb = vec3( 1.0, 0.0, 0.0) : pnt.rgb;\n    ( pnt.r == .2 || pnt.g == .2 || pnt.b == .2 ) ? pnt.rgb = vec3( 0.0, 1.0, 0.0) : pnt.rgb;\n    ( pnt.r == .3 || pnt.g == .3 || pnt.b == .3 ) ? pnt.rgb = vec3( 0.0, 0.0, 1.0) : pnt.rgb;\n    ( pnt.r == .4 || pnt.g == .4 || pnt.b == .4 ) ? pnt.rgb = vec3( 1.0, 1.0, 0.0) : pnt.rgb;\n    ( pnt.r == .5 || pnt.g == .5 || pnt.b == .5 ) ? pnt.rgb = vec3( 0.0, 1.0, 1.0) : pnt.rgb;\n    ( pnt.r == .6 || pnt.g == .6 || pnt.b == .6 ) ? pnt.rgb = vec3( 1.0, 0.0, 1.0) : pnt.rgb;\n    ( pnt.r == .7 || pnt.g == .7 || pnt.b == .7 ) ? pnt.rgb = vec3( 1.0, 0.49, 0.49) : pnt.rgb;\n    ( pnt.r == .8 || pnt.g == .8 || pnt.b == .8 ) ? pnt.rgb = vec3( 0.49, 1.0, 0.49) : pnt.rgb;\n    ( pnt.r == .9 || pnt.g == .9 || pnt.b == .9 ) ? pnt.rgb = vec3( 0.49, 0.49, 1.0) : pnt.rgb;\n\n    return pnt;\n  }\n\n  // BRIGHTNESS [ 0 - 1 ]\n  // http://blog.ruofeidu.com/postprocessing-brightness-contrast-hue-saturation-vibrance/\n  if ( currentcoloreffect == 60 ) {\n    return vec4( src.rgb + extra, src.a );\n    //return vec4( src.rgb ^ (extra+1), src.a );\n  }\n\n  // CONTRAST [ 0 - 3 ]\n  if ( currentcoloreffect == 61 ) {\n    extra = extra * 3.;\n    float t = 0.5 - extra * 0.5;\n    src.rgb = src.rgb * extra + t;\n    return vec4( src.rgb, src.a );\n  }\n\n  // SATURATION [ 0 - 5 ]\n  if ( currentcoloreffect == 62 ) {\n    extra = extra * 5.;\n    vec3 luminance = vec3( 0.3086, 0.6094, 0.0820 );\n    float oneMinusSat = 1.0 - extra;\n    vec3 red = vec3( luminance.x * oneMinusSat );\n    red.r += extra;\n\n    vec3 green = vec3( luminance.y * oneMinusSat );\n    green.g += extra;\n\n    vec3 blue = vec3( luminance.z * oneMinusSat );\n    blue.b += extra;\n\n    return mat4(\n      red,     0,\n      green,   0,\n      blue,    0,\n      0, 0, 0, 1 ) * src;\n  }\n\n  // SHIFT HUE\n  if ( currentcoloreffect == 63 ) {\n    vec3 P = vec3(0.55735) * dot( vec3(0.55735), src.rgb );\n    vec3 U = src.rgb - P;\n    vec3 V = cross(vec3(0.55735), U);\n    src.rgb = U * cos( extra * 6.2832) + V * sin( extra * 6.2832) + P;\n    return src;\n  }\n\n  // hard black edge\n  if ( currentcoloreffect == 64 ) {\n    src.r + src.g + src.b > extra * 3.0? src.rgb = vec3( 1.0, 1.0, 1.0 ) : src.rgb = vec3( 0.0, 0.0, 0.0 );\n    return src;\n  }\n\n  // greenkey\n  if ( currentcoloreffect == 80 ) {\n    float temp_g = src.g;\n\n    //if ( src.g > 0.99 ) { // 135\n    if ( src.g > 0.2 && src.r < 0.2 && src.b < 0.2 ){\n      src.r = 0.0;\n      src.g = 0.0;\n      src.b = 0.0;\n      src.a = 0.0;\n    }\n\n    if ( src.g > 0.2 && src.r < 0.2 && src.b < 0.2 ){\n      src.r + src.g + src.b > extra * 3.0? src.rgb = vec3( 1.0, 1.0, 1.0 ) : src.rgb = vec3( 0.0, 0.0, 0.0 );\n    }\n\n\n    float maxrb = max( src.r, src.b );\n    float k = clamp( (src.g-maxrb)*5.0, 0.0, 1.0 );\n\n    //float ll = length( src );\n    //src.g = min( src.g, maxrb*0.8 );\n    //src = ll*normalize(src);\n\n    return vec4( mix(src.xyz, vec3(0.0, 0.0, 0.0), k), src.a );\n\n    //return vec4( src.xyz, src.a );\n    //return src;\n  }\n\n  // greenkey 2\n  if ( currentcoloreffect == 81 ) {\n\n    float maxrb = max( src.r, src.b );\n    float k = clamp( (src.g-maxrb)*5.0, 0.0, 1.0 );\n\n    //\n\n    //float ll = length( src );\n    //src.g = min( src.g, maxrb*0.8 );\n    //src = ll*normalize(src);\n\n    //else\n\n    //float dg = src.g;\n    //src.g = min( src.g, maxrb*0.8 );\n    //src += dg - src.g;\n\n    //#endif\n\n    vec3 bg = src.xyz;\n    bg.r = 0.0;\n    bg.g = 0.0;\n    bg.b = 0.0;\n\n    return vec4( mix(src.xyz, bg, k), mix( 1.0, 0.0, k) );\n    //return src;\n  }\n\n  if ( currentcoloreffect == 70 ) {\n    return src;\n  }\n\n\n\n\n\n  // default\n  return src;\n}\n\n/* custom_helpers */\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+r.uuid+"_output = coloreffect( "+t.uuid+"_output, "+r.uuid+"_currentcoloreffect, "+r.uuid+"_extra, vUv );\n  /* custom_main */")},r.update=function(){},r.effect=function(e){return null!=e&&(o=e,console.log("effect set to: ",o),renderer.customUniforms[r.uuid+"_currentcoloreffect"].value=o),o},r.extra=function(e){return null!=e&&(u=e,renderer.customUniforms[r.uuid+"_extra"].value=u),r.debug&&console.log("extra set to: ",u),u}}function DistortionEffect(e,n){var r=this;null==n.uuid?r.uuid="DistortionEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,null==n.fragmentChannel?r._fragmentChannel=1:r._fragmentChannel=n.fragmentChannel,e.add(r),r.type="Effect";var t=n.source,o=n.effect,u=(o=1,.8),c="\n\n  bool mask_circle(vec2 uv, float radius, float x, float y){\n      \n    // uv.x *= 1.6; \n     uv.y /= (16.0 / 9.0);\n    float len = sqrt(pow((uv.x - x),2.0) + pow(uv.y - y,2.0));\n    if(len < radius){\n      return true;\n    }\n    return false;\n  }\n  \n  bool tophTest(float a){\n    return true;\n  }\n  \n  vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv ) {\n    \n    // normal\n    if ( currentdistortioneffect == 1 ) {\n      return texture2D( src, vUv ).rgba;\n    }\n  \n    // TOPHER_DIST_MIRROR_CIRCLES\n    if ( currentdistortioneffect == 100 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      float radius = 0.06;\n      float x = -0.24;\n      float y = +0.0;\n      float scale = 4.0;\n  \n      if(mask_circle(uv, radius, x, y)  || mask_circle(uv, radius, -x, y)) {\n        //gl_FragColor = texture2D( src, vUv ).rgba;\n  \n        vec2 uvs = vec2(uv);\n        \n        if ( uv.x < 0.0){\n            uvs.x -= x;\n            uvs *= scale;\n        }else{\n            uvs.x += x;\n            uvs *= scale;\n            uvs.x = - uvs.x;\n        }\n  \n        if (uvs.x < -0.5 || uvs.x > 0.5 || uvs.y < -0.5 || uvs.y > 0.5 ){\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        } else{\n            vec4 pixelColor = texture2D(src, vec2(uvs.x + 0.5, uvs.y + 0.5)); \n            gl_FragColor = vec4(pixelColor);\n        }\n  \n      }else{\n        gl_FragColor = vec4(0.0, 0.0, 0.2, 1.0);\t\n      }\n      return gl_FragColor;\n    }\n  \n  \n    // TOPHER_DIST_CIRCLE_2 - 2 circles on the side.\n    if ( currentdistortioneffect == 101 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5);\n      float radius = 0.2;\n      float x = -0.2;\n      float y = +0.0;\n      float scale = 4.0;\n  \n      if(mask_circle(uv, radius, x, y)  || mask_circle(uv, radius, -x, y)) {\n        gl_FragColor = texture2D( src, vUv ).rgba;\n      }else{\n        gl_FragColor = vec4(0.0, 0.0, 0.3, 1.0);\t\n      }\n      return gl_FragColor;\n    }\n  \n    // TOPHER_DIST_CIRCLE_3 - 3 circles\n    if ( currentdistortioneffect == 102 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5);\n      float radius = 0.06;\n      float x = -0.24;\n      float y = +0.0;\n  \n      if(mask_circle(uv, radius, x, y)  ||  mask_circle(uv, radius, -x, y) ||  mask_circle(uv, 0.12, 0.0, 0.0)) {\n       \n        gl_FragColor = texture2D( src, vUv ).rgba;\n      }else{\n        gl_FragColor = vec4(0.0, 0.1, 0.0, 1.0);\t\n      }\n      return gl_FragColor;\n    }\n  \n  \n    // TOPHER_DIST_CENTER_CIRCLE\n    if ( currentdistortioneffect == 103 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      float radius = 0.12;\n      float x = -0.0;\n      float y = +0.0;\n      float scale = 2.5;\n  \n      if(mask_circle(uv, radius, x, y)) {\n  \n        vec2 uvs = vec2(uv);\n        uvs *= scale;\n        \n        if (uvs.x < -0.5 || uvs.x > 0.5 || uvs.y < -0.5 || uvs.y > 0.5 ){\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        } else{\n            vec4 pixelColor = texture2D(src, vec2(uvs.x + 0.5, uvs.y + 0.5)); \n            gl_FragColor = vec4(pixelColor);\n        }\n  \n      }else{\n        gl_FragColor = vec4(0.0, 0.0, 0.4, 1.0);\t\n        // gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\t//transpparent\n        //discard;\n      }\n      // gl_FragColor = vec4(0.4, 0.0, 0.2, 1.0);\n      return gl_FragColor;\n    }//103\n  \n    //ONLY SQUASH\n    if ( currentdistortioneffect == 104 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      float radius = 0.3;\n      float x = -0.0;\n      float y = +0.0;\n      float scale = 1.5;\n  \n      vec2 uvs = vec2(uv);\n      // uvs *= scale;\n      uvs.x *= 1.333;\n      \n      vec4 pixelColor = texture2D(src, vec2(uvs.x + 0.5, uvs.y + 0.5)); \n      gl_FragColor = vec4(pixelColor);\n  \n  \n  \n      // gl_FragColor = vec4(0.4, 0.0, 0.2, 1.0);\n      return gl_FragColor;\n    }//104\n  \n    //ONLY CIRCLE\n    if ( currentdistortioneffect == 105 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      float radius = 0.28;\n      float scale = 1.0; //Size of video.\n  \n      if(mask_circle(uv, radius, 0.0, 0.0)) {\n        vec2 uvs = vec2(uv);\n        uvs *= scale;\n        vec4 pixelColor = texture2D(src, vec2(uvs.x + 0.5, uvs.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }else{\n        gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0);\t\n        discard;\n      }\n      return gl_FragColor;\n    }//105\n  \n    //MIRROR\n    if ( currentdistortioneffect == 106 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      \n      if (uv.y > 0.0){\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n       \n      }else{\n        // gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0);\n        // discard;\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, -uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }\n\n      if (uv.y > 0.3){\n        discard;\n      }\n        \t\n      gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0);\n      \n      return gl_FragColor;\n    }//105\n  \n  \n    // phasing sides (test)\n    if ( currentdistortioneffect == 2 ) {\n      vec2 wuv = vec2(0,0);\n      if ( gl_FragCoord.x > screenSize.x * 0.5 ) wuv = vUv * vec2( 1., cos( time * .01 ) * 1. );\n      if ( gl_FragCoord.x < screenSize.x * 0.5 ) wuv = vUv * vec2( 1., sin( time * .01 ) * 1. );\n      wuv = wuv + vec2( .0, .0 );\n      return texture2D( src, wuv ).rgba;\n    }\n  \n    // multi\n    if ( currentdistortioneffect == 3 ) {\n      vec2 wuv = vec2(0,0);\n      wuv = vUv * vec2( extra*6., extra*6. ) - vec2( extra * 3., extra * 3. );\n      // wuv = vUv + vec2( extra, extra );\n      return texture2D( src, wuv ).rgba;\n    }\n  \n    // pip\n    if ( currentdistortioneffect == 4 ) {\n      vec2 wuv = vec2(0,0);\n      wuv = vUv * vec2( 2, 2 ) + vec2( 0., 0. );\n      float sil = 1.;\n  \n      // top-left\n      if ( gl_FragCoord.x < ( screenSize.x * 0.07 ) || ( gl_FragCoord.x > screenSize.x * 0.37 ) ) sil = 0.;\n      if ( gl_FragCoord.y < ( screenSize.y * 0.60 ) || ( gl_FragCoord.y > screenSize.y * 0.97 ) ) sil = 0.;\n      return texture2D( src, wuv ).rgba * vec4( sil, sil, sil, sil );\n    }\n  }\n  \n  \n  \n  \n    // -------------\n  \n    // wipes (move these to mixer?)\n    //if ( gl_FragCoord.x > 200.0 ) {\n    //  return vec4(0.0,0.0,0.0,0.0);\n    //}else {\n    //  return src;\n    //}\n  \n  /* custom_helpers */\n  \n  \n  ";r.init=function(){e.customUniforms[r.uuid+"_currentdistortioneffect"]={type:"i",value:1},e.customUniforms[r.uuid+"_extra"]={type:"f",value:2},1==r._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+r.uuid+"_currentdistortioneffect;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==renderer.fragmentShader.indexOf("vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv )")&&(console.log("DistortionEffect REPLACE"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */",c)),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","      vec4 "+r.uuid+"_output = distortioneffect( "+t.uuid+", "+r.uuid+"_currentdistortioneffect, "+r.uuid+"_extra, vUv );\n  /* custom_main */")):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform int "+r.uuid+"_currentdistortioneffect;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==renderer.fragmentShader2.indexOf("vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv )")&&(console.log("DistortionEffect REPLACE"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_helpers */",c)),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */","      vec4 "+r.uuid+"_output = distortioneffect( "+t.uuid+", "+r.uuid+"_currentdistortioneffect, "+r.uuid+"_extra, vUv );\n  /* custom_main */"))};r.update=function(){.001},r.effect=function(e){return null!=e&&(o=e,renderer.customUniforms[r.uuid+"_currentdistortioneffect"]&&(renderer.customUniforms[r.uuid+"_currentdistortioneffect"].value=e)),o},r.extra=function(e){return null!=e&&(u=e,renderer.customUniforms[r.uuid+"_extra"]&&(renderer.customUniforms[r.uuid+"_extra"].value=u)),e}}function DistortionEffect(e,n){var r=this;null==n.uuid?r.uuid="DistortionEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,null==n.fragmentChannel?r._fragmentChannel=1:r._fragmentChannel=n.fragmentChannel,e.add(r),r.type="Effect";var t=n.source,o=n.effect,u=(o=1,.8),c="\n\n  bool mask_circle(vec2 uv, float radius, float x, float y){\n      \n    // uv.x *= 1.6; \n     uv.y /= (16.0 / 9.0);\n    float len = sqrt(pow((uv.x - x),2.0) + pow(uv.y - y,2.0));\n    if(len < radius){\n      return true;\n    }\n    return false;\n  }\n  \n  bool tophTest(float a){\n    return true;\n  }\n  \n  vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv ) {\n    \n    // normal\n    if ( currentdistortioneffect == 1 ) {\n      return texture2D( src, vUv ).rgba;\n    }\n  \n    //ONLY CIRCLE\n    if ( currentdistortioneffect == 105 ) {\n  \n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      float radius = 0.28;\n      float scale = 1.0; //Size of video.\n  \n      if(mask_circle(uv, radius, 0.0, 0.0)) {\n        vec2 uvs = vec2(uv);\n        uvs *= scale;\n        vec4 pixelColor = texture2D(src, vec2(uvs.x + 0.5, uvs.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }else{\n        gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0);\t\n        discard;\n      }\n      return gl_FragColor;\n    }//105\n  \n    //MIRROR_VERTICAL\n    if ( currentdistortioneffect == 106 ) {\n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      if (uv.y >= 0.0){\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }else{\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, -uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }\n      // gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0); \n      return gl_FragColor;\n    }//MIRROR_VERTICAAL\n  \n    //MIRROR_HORIZONTAL\n    if ( currentdistortioneffect == 107 ) {\n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      if (uv.x > 0.0){\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }else{\n        vec4 pixelColor = texture2D(src, vec2(-uv.x + 0.5, uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }\n      // gl_FragColor = vec4(0.0, 0.2, 0.0, 1.0); \n      return gl_FragColor;\n    }//MIRROR_VERTICAAL\n\n    //WIPE_HORIZONTAL\n    if ( currentdistortioneffect == 108 ) {\n      vec2 uv = vec2(vUv.x - 0.5, vUv.y - 0.5); //assuming they are 0 to 1.\n      if (uv.x > (extra - 0.5)){\n        vec4 pixelColor = texture2D(src, vec2(uv.x + 0.5, uv.y + 0.5)); \n        gl_FragColor = vec4(pixelColor);\n      }else{\n        gl_FragColor = vec4(0.0, 0.2, 0.0, 0.0); \n      }\n\n      return gl_FragColor;\n    }//WIPE_HORIZONTAL\n  \n    \n  }\n  \n  \n  \n  \n    // -------------\n  \n\n  \n  /* custom_helpers */\n  \n  \n  ";r.init=function(){e.customUniforms[r.uuid+"_currentdistortioneffect"]={type:"i",value:1},e.customUniforms[r.uuid+"_extra"]={type:"f",value:2},1==r._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+r.uuid+"_currentdistortioneffect;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==e.fragmentShader.indexOf("vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv )")&&(console.log("DistortionEffect REPLACE"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */",c)),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","      vec4 "+r.uuid+"_output = distortioneffect( "+t.uuid+", "+r.uuid+"_currentdistortioneffect, "+r.uuid+"_extra, vUv );\n  /* custom_main */")):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform int "+r.uuid+"_currentdistortioneffect;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==e.fragmentShader2.indexOf("vec4 distortioneffect ( sampler2D src, int currentdistortioneffect, float extra, vec2 vUv )")&&(console.log("DistortionEffect REPLACE"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_helpers */",c)),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */","      vec4 "+r.uuid+"_output = distortioneffect( "+t.uuid+", "+r.uuid+"_currentdistortioneffect, "+r.uuid+"_extra, vUv );\n  /* custom_main */"))};r.update=function(){.001},r.effect=function(n){return null!=n&&(o=n,e.customUniforms[r.uuid+"_currentdistortioneffect"]&&(e.customUniforms[r.uuid+"_currentdistortioneffect"].value=n)),o},r.extra=function(n){return null!=n&&(u=n,e.customUniforms[r.uuid+"_extra"]&&(e.customUniforms[r.uuid+"_extra"].value=u)),n}}function FeedbackEffect(e,n){var r=this;null==n.uuid?r.uuid="FeedbackEffect_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,e.add(r),r.type="Effect";var t,o,u=n.source,c=n.effect,a=(c=12,.8),i=128*window.devicePixelRatio;new Uint8Array(i*i*3);r.init=function(){(t=document.createElement("canvas")).width=1024,t.height=1024,canvasElementContext=t.getContext("2d"),canvasElementContext.fillStyle="#000000",canvasElementContext.fillRect(0,0,1024,1024),console.log("FeedbackEffect inits, with",e),(o=new THREE.Texture(t)).wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping,o.repeat.set(4,4),e.customUniforms[r.uuid+"_effectsampler"]={type:"t",value:o},e.customUniforms[r.uuid+"_currentfeedbackeffect"]={type:"i",value:c},e.customUniforms[r.uuid+"_extra"]={type:"i",value:a},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D  "+r.uuid+"_effectsampler;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int  "+r.uuid+"_currentfeedbackeffect;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float  "+r.uuid+"_extra;\n/* custom_uniforms */"),-1==renderer.fragmentShader.indexOf("vec4 feedbackeffect ( vec4 src, int currentfeedbackeffect, vec2 vUv )")&&(e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\n  vec4 feedbackeffect ( vec4 src, int currentfeedbackeffect, vec2 vUv ) {\n\n    if ( currentfeedbackeffect == 100 ) {\n      // vec4 inbetween = vec4( src.r, src.g, src.b, vUv * 0.9. );\n      // gl_Position = vec4( vec2(0.,0.), 0., 0.);\n      // return inbetween.rrr;\n      // return src;\n\n      // return vec4(0., 0., 1., 1.);\n\n      vec2 wuv = vec2(0.,0.);\n      // wuv = vUv * vec2( 1.0, 1.0 ) - vec2( 0., 0. );\n      wuv = vUv; //* vec2( 1.0, 1.0 ) - vec2( 0., 0. );\n      //wuv = vUv - vec2( 0.1, 0. );\n      // wuv = vUv + vec2( extra, extra );\n      // return texture2D( src, wuv ).rgba;\n\n      return vec4( vec4( ( texture2D( "+r.uuid+"_effectsampler, wuv ).rgba * 0.9 ) + (src.rgba * .6 ) ).rgb, 1.);\n\n      // return ( texture2D( , vUv + vec2( 1., 0.99999999) ).rgba ) + src * 0.3;\n\n      // return ( texture2D( "+r.uuid+"_effectsampler, vUv  ).rgb * 1.4 + src * .8) * 0.5; //* vec3(.5, .5, .5\n      // return ( texture2D( src, vUv ).rgb );\n      // return ( texture2D( "+r.uuid+"_effectsampler, vUv  ).rgb ) * src + src;\n\n      //vec4 wuv = wuv = vUv * vec2( extra*6., extra*6. ) - vec2( extra * 3., extra * 3. );\n      //vec4 tex = texture2D( "+r.uuid+"_effectsampler, wuv ); //+ vec4( src.r, src.g, src.b, vUv * 2. );\n\n      // return src.rrr;\n      // tex.rgb = vec3(src.r, src.g, src.b);\n      // tex.xy = vec2(1.0,1.0);\n      // tex = tex + vec4( src.r, src.g, src.b, vUv * 2. );\n\n\n      // * 0.52 + vec4( src * 0.52, vUv ) *\n      // vec4 tex = vec4( src, vUv * .5 );\n      // return mix( tex, "+r.uuid+"_effectsampler, 0.).rgb;\n      // return mix(tex.rgb, src.rgb, 1.);\n    }\n\n    // uniform float noiseScale;\n    // uniform float time;\n    // uniform float baseSpeed;\n    // uniform sampler2D noiseTexture;\n\n    if ( currentfeedbackeffect == 101 ) {\n      // vec2 uvTimeShift = vUv + vec2( -0.7, 1.5 ) * time * baseSpeed;\n      // vec4 noiseGeneratorTimeShift = texture2D( noiseTexture, uvTimeShift );\n      // vec2 uvNoiseTimeShift = vUv + noiseScale * vec2( noiseGeneratorTimeShift.r, noiseGeneratorTimeShift.a );\n\n      // _effectsampler\n      // return  vec4 texture2D( baseTexture1, uvNoiseTimeShift )\n\n      // https://stackoverflow.com/questions/19872524/threejs-fragment-shader-using-recycled-frame-buffers\n      // http://labs.sense-studios.com/webgl/index4.html?r=sdad\n\n      // return _effectsampler.rgb\n      return src;\n    }\n\n    return src;\n  }\n\n  /* custom_helpers */\n")),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+r.uuid+"_output = feedbackeffect( "+u.uuid+"_output, "+r.uuid+"_currentfeedbackeffect, vUv );\n  /* custom_main */")};new THREE.Vector2;var s=0;r.update=function(){if(s++,glcanvas=document.getElementById("glcanvas"),s%4==0){var e=1024*(1.6*a),n=(1024-e)/2;canvasElementContext.drawImage(glcanvas,n,n,e,e)}o&&(o.needsUpdate=!0)},r.effect=function(e){return null!=e&&(c=e,renderer.customUniforms[r.uuid+"_currentfeedbackeffect"].value=c),c},r.extra=function(e){return null!=e&&(a=e,renderer.customUniforms[r.uuid+"_extra"].value=a),a}}AudioAnalysis.prototype=new Addon,AudioAnalysis.constructor=AudioAnalysis,BPM.prototype=new Addon,BPM.constructor=BPM,FileManager.prototype=new Addon,FileManager.constructor=FileManager,GiphyManager.prototype=new Addon,GiphyManager.constructor=GiphyManager,GamePadController.prototype=new Controller,GamePadController.constructor=GamePadController,KeyboardController.prototype=new Controller,KeyboardController.constructor=KeyboardController,MidiController.prototype=new Controller,MidiController.constructor=MidiController,SocketController.prototype=new Controller,SocketController.constructor=SocketController,ColorEffect.prototype=new Effect,ColorEffect.constructor=ColorEffect,DistortionEffect.prototype=new Effect,DistortionEffect.constructor=DistortionEffect,DistortionEffect.prototype=new Effect,DistortionEffect.constructor=DistortionEffect,FeedbackEffect.prototype=new Effect,FeedbackEffect.constructor=FeedbackEffect;var GlRenderer=function(e){var n=this;n.options={element:"glcanvas"},null!=e&&(n.options=e),n.element=document.getElementById(n.options.element),n.onafterrender=function(){},n.width=window.innerWidth,n.height=window.innerHeight,n.scene=new THREE.Scene,n.camera=new THREE.PerspectiveCamera(75,n.width/n.height,.1,1e3),n.camera.position.z=20,n.nodes=[],n.customUniforms={},n.customDefines={};var r=0;n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n    varying vec2 vUv;    void main() {      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );      vUv = uv;    }\n  ",n.fragmentShader="\n    uniform float time;\n    uniform vec2 screenSize;\n\n    /* custom_uniforms */    /* custom_helpers */    varying vec2 vUv;    void main() {      /* custom_main */    }\n  ",n.init=function(){console.log("init renderer"),n.glrenderer=new THREE.WebGLRenderer({canvas:glcanvas,alpha:!1}),n.nodes.forEach(function(e){e.init()}),n.shaderMaterial=new THREE.ShaderMaterial({uniforms:n.customUniforms,defines:n.customDefines,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:THREE.DoubleSide,transparent:!0}),n.flatGeometry=new THREE.PlaneGeometry(67,38),n.flatGeometry.translate(0,0,0),n.surface=new THREE.Mesh(n.flatGeometry,n.shaderMaterial),n.scene.add(n.surface)},n.render=function(){requestAnimationFrame(n.render),n.glrenderer.render(n.scene,n.camera),n.onafterrender(),n.glrenderer.setSize(n.width,n.height),n.nodes.forEach(function(e){e.update()}),r++,n.customUniforms.time.value=r},n.resize=function(){n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.camera.aspect=n.width/n.height,n.camera.updateProjectionMatrix(),n.glrenderer.setSize(n.width,n.height)},window.addEventListener("resize",function(){n.resize()}),n.add=function(e){n.nodes.push(e)},n.dispose=function(){n.shaderMaterial,n.flatGeometry,n.scene.remove(n.surface),n.glrenderer.resetGLState(),n.customUniforms={},n.customDefines={},r=0,n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n      varying vec2 vUv;\n      void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n        vUv = uv;\n      }\n    ",n.fragmentShader="\n      uniform int time;\n      uniform vec2 screenSize;\n\n      /* custom_uniforms */\n      /* custom_helpers */\n      varying vec2 vUv;\n      void main() {\n        /* custom_main */\n      }\n    ",n.nodes=[]}},Mapping=(GlRenderer=function(e){console.log("START GlRenderer  -------------------");var n=this;n.options={element:"glcanvas"},null!=e&&(n.options=e),n.options.canvas?n.element=n.options.canvas:n.element=document.getElementById(n.options.element),n.onafterrender=function(){},n.options.width&&n.options.height?(n.width=n.options.width,n.height=n.options.height):(n.width=window.innerWidth,n.height=window.innerHeight),n.scene=new THREE.Scene,n.camera=new THREE.PerspectiveCamera(75,n.width/n.height,.1,1e3),n.camera.position.z=20,n.nodes=[],n.customUniforms={},n.customDefines={};var r=0;n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n        varying vec2 vUv;        void main() {          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );          vUv = uv;        }\n      ",n.fragmentShader="\n        uniform float time;\n        uniform vec2 screenSize;\n    \n        /* custom_uniforms */        /* custom_helpers */        varying vec2 vUv;        void main() {          /* custom_main */        }\n      ",n.init=function(){console.log("INIT Renderer -------------------"),n.glrenderer=new THREE.WebGLRenderer({canvas:n.element,alpha:!1,preserveDrawingBuffer:!0}),n.nodes.forEach(function(e){e.init()}),n.shaderMaterial=new THREE.ShaderMaterial({uniforms:n.customUniforms,defines:n.customDefines,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:THREE.DoubleSide,transparent:!0}),n.flatGeometry=new THREE.PlaneGeometry(67,38),n.flatGeometry.translate(0,0,0),n.surface=new THREE.Mesh(n.flatGeometry,n.shaderMaterial),n.scene.add(n.surface)},n.render=function(){requestAnimationFrame(n.render),n.glrenderer.render(n.scene,n.camera),n.onafterrender(),n.glrenderer.setSize(n.width,n.height),n.nodes.forEach(function(e){e.update()}),r++,n.customUniforms.time.value=r},n.resize=function(){n.options.autosize&&(n.height=window.innerHeight,n.width=window.innerWidth),n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.camera.aspect=n.width/n.height,n.camera.updateProjectionMatrix(),n.glrenderer.setSize(n.width,n.height)},window.addEventListener("resize",function(){n.resize()}),n.add=function(e){n.nodes.push(e)},n.dispose=function(){n.shaderMaterial,n.flatGeometry,n.scene.remove(n.surface),n.glrenderer.resetGLState(),n.customUniforms={},n.customDefines={},r=0,n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n          varying vec2 vUv;\n          void main() {\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            vUv = uv;\n          }\n        ",n.fragmentShader="\n          uniform int time;\n          uniform vec2 screenSize;\n    \n          /* custom_uniforms */\n          /* custom_helpers */\n          varying vec2 vUv;\n          void main() {\n            /* custom_main */\n          }\n        ",n.nodes=[]}},GlRenderer=function(e){console.log("START GlRenderer  -------------------");var n=this;n.options={element:"glcanvas"},null!=e&&(n.options=e),n.options.canvas?n.element=n.options.canvas:n.element=document.getElementById(n.options.element),n.onafterrender=function(){},n.options.width&&n.options.height?(n.width=n.options.width,n.height=n.options.height):(n.width=window.innerWidth,n.height=window.innerHeight),n.scene=new THREE.Scene,n.camera=new THREE.PerspectiveCamera(75,n.width/n.height,.1,1e3),n.camera.position.z=27,n.nodes=[],n.customUniforms={},n.customDefines={};var r=0;n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n        varying vec2 vUv;        void main() {          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );          vUv = uv;        }\n      ",n.fragmentShader="\n        uniform float time;\n        uniform vec2 screenSize;\n    \n        /* custom_uniforms */        /* custom_helpers */        varying vec2 vUv;        void main() {          /* custom_main */        }\n      ",n.fragmentShader2="\n      uniform float time;\n      uniform vec2 screenSize;\n  \n      /* custom_uniforms */      /* custom_helpers */      varying vec2 vUv;      void main() {        /* custom_main */      }\n    ",n.init=function(){console.log("INIT Renderer -------------------"),n.glrenderer=new THREE.WebGLRenderer({canvas:n.element,alpha:!1,preserveDrawingBuffer:!0}),n.nodes.forEach(function(e){e.init()}),n.shaderMaterial=new THREE.ShaderMaterial({uniforms:n.customUniforms,defines:n.customDefines,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:THREE.DoubleSide,transparent:!0}),n.shaderMaterial2=new THREE.ShaderMaterial({uniforms:n.customUniforms,defines:n.customDefines,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader2,side:THREE.DoubleSide,transparent:!0});n.flatGeometry=new THREE.PlaneGeometry(71,39.9375,10,10),n.flatGeometry.translate(0,0,0),n.surface=new THREE.Mesh(n.flatGeometry,n.shaderMaterial),n.flatGeometry2=new THREE.PlaneGeometry(71,39.9375,10,10),n.flatGeometry2.rotateY(Math.PI/1),n.flatGeometry2.translate(80,-45,1),n.surface2=new THREE.Mesh(n.flatGeometry2,n.shaderMaterial2),n.surface2.scale.set(.3,.3,.3),n.flatGeometry3=new THREE.PlaneGeometry(71,39.9375,10,10),n.flatGeometry3.translate(-80,-45,1),n.surface3=new THREE.Mesh(n.flatGeometry3,n.shaderMaterial2),n.surface3.scale.set(.3,.3,.3),n.scene.add(n.surface),n.scene.add(n.surface2),n.scene.add(n.surface3)},n.render=function(){requestAnimationFrame(n.render),n.glrenderer.render(n.scene,n.camera),n.onafterrender(),n.glrenderer.setSize(n.width,n.height),n.nodes.forEach(function(e){e.update()}),r++,n.customUniforms.time.value=r},n.resize=function(){n.options.autosize&&(n.height=window.innerHeight,n.width=window.innerWidth),n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.camera.aspect=n.width/n.height,n.camera.updateProjectionMatrix(),n.glrenderer.setSize(n.width,n.height)},window.addEventListener("resize",function(){n.resize()}),n.add=function(e){n.nodes.push(e)},n.dispose=function(){n.shaderMaterial,n.flatGeometry,n.shaderMaterial2,n.flatGeometry2,n.shaderMaterial3,n.flatGeometry3,n.scene.remove(n.surface),n.scene.remove(n.surface2),n.scene.remove(n.surface3),n.glrenderer.resetGLState(),n.customUniforms={},n.customDefines={},r=0,n.customUniforms.time={type:"f",value:r},n.customUniforms.screenSize={type:"v2",value:new THREE.Vector2(n.width,n.height)},n.vertexShader="\n          varying vec2 vUv;\n          void main() {\n            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            vUv = uv;\n          }\n        ",n.fragmentShader="\n          uniform int time;\n          uniform vec2 screenSize;\n    \n          /* custom_uniforms */\n          /* custom_helpers */\n          varying vec2 vUv;\n          void main() {\n            /* custom_main */\n          }\n        ",n.fragmentShader2="\n                uniform int time;\n                uniform vec2 screenSize;\n          \n                /* custom_uniforms */\n                /* custom_helpers */\n                varying vec2 vUv;\n                void main() {\n                  /* custom_main */\n                }\n              ",n.nodes=[]}},class{static function_list(){return[]}static help(){return"ownoes"}constructor(e,n){var r=this;null!=e&&(null==n.uuid?r.uuid="Mapping_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,r.renderer=e,r.source=n.source,e.add(r),r.type="Module",r.internal_renderer=null,r.init=function(){r.vertexShader_test="\n          varying vec2 vUv;          void main() {            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );            vUv = uv;          }\n        ",r.fragmentShader_test="\n            uniform float time;\n            uniform vec2 screenSize;\n  \n            /* custom_uniforms */            /* custom_helpers */            varying vec2 vUv;            void main() {              /* custom_main */            }\n          ",r.internal_renderer=new GlRenderer({element:n.element}),console.log(" fragment_shader: "),r.internal_renderer.fragmentShader=r.renderer.fragmentShader,r.internal_renderer.vertexShader=r.renderer.vertexShader,console.log(" uniforms: "),console.log(r.renderer.customUniforms),r.internal_renderer.customUniforms=r.renderer.customUniforms,r.internal_renderer.customDefines=r.renderer.customDefines;new Output(r.internal_renderer,r.source);r.internal_renderer.init(),r.internal_renderer.render()},r.update=function(){document.getElementById("sourceCanvas")},r.mapping={},r.load_pixelmap=function(e){(new Utils).get(e,function(e){r.mapping=JSON.parse(e)})})}});function Module(e,n){this.type="Module",this.init=function(){},this.update=function(){},this.render=function(){}}function Chain(e,n){var r,t=this;null==n.uuid?t.uuid="Chain_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):t.uuid=n.uuid,e.add(t),null!=n&&(r=n),t.type="Module",t.sources=r.sources,t.sources.forEach(function(n,r){e.customUniforms[t.uuid+"_source"+r+"_alpha"]={type:"f",value:.5}}),t.sources.forEach(function(n,r){e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+t.uuid+"_source"+r+"_alpha;\n/* custom_uniforms */")}),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+t.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+t.uuid+"_output;\n/* custom_uniforms */"),t.init=function(){var n="vec4(0.0,0.0,0.0,0.0)";t.sources.forEach(function(e,r){n+=" + ("+e.uuid+"_output * "+t.uuid+"_source"+r+"_alpha )"}),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+t.uuid+"_output = vec4( "+n+"); /* custom_main */")},t.update=function(){},t.setChainLink=function(n,r){e.customUniforms[t.uuid+"_source"+n+"_alpha"].value=r},t.getChainLink=function(n){return e.customUniforms[t.uuid+"_source"+n+"_alpha"].value},t.setAll=function(n=0){t.sources.forEach(function(r,o){e.customUniforms[t.uuid+"_source"+o+"_alpha"].value=n})},t.toggle=function(n,r){void 0===r?1==e.customUniforms[t.uuid+"_source"+n+"_alpha"].value?e.customUniforms[t.uuid+"_source"+n+"_alpha"].value=0:(e.customUniforms[t.uuid+"_source"+n+"_alpha"].value=1,current=n):e.customUniforms[t.uuid+"_source"+n+"_alpha"].value=r}}var Mixer=class{static function_list(){return[["BLEND","method","blendMode"],["MIX","method","mixMode"],["POD","set","pod"]]}constructor(e,n){var r=this;if(null!=e){null==n.uuid?r.uuid="Mixer_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,null==n.fragmentChannel?r._fragmentChannel=1:r._fragmentChannel=n.fragmentChannel,e.add(r),null!=n&&n,r.type="Module";var t=1,o=0,u=0,c=128,a=1,i=function(){return c};r.autoFade=!1,r.fading=!1;var s=1;r.mixmodes=[1,2,3,4,5,6,7,8,9];var l,d,m=1;r.blendmodes=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18],l=n.source1,d=n.source2;var f="";f+="vec4 "+r.uuid+"_output = vec4( blend( ",f+=l.uuid+"_output * "+r.uuid+"_alpha1, ",f+=d.uuid+"_output * "+r.uuid+"_alpha2, ",f+=r.uuid+"_blendmode ) ",f+=")",f+=" + vec4(  "+l.uuid+"_output.a < 1.0 ? "+d.uuid+"_output.rgba * ( "+r.uuid+"_alpha1 - "+l.uuid+"_output.a ) : vec4( 0.,0.,0.,0. )  ) ",f+=" + vec4(  "+d.uuid+"_output.a < 1.0 ? "+l.uuid+"_output.rgba * ( "+r.uuid+"_alpha2 - - "+d.uuid+"_output.a ) : vec4( 0.,0.,0.,0. )  ) ",f+=";\n",f+="  /* custom_main */  ",r.init=function(){var n;e.customUniforms[r.uuid+"_mixmode"]={type:"i",value:1},e.customUniforms[r.uuid+"_blendmode"]={type:"i",value:1},e.customUniforms[r.uuid+"_alpha1"]={type:"f",value:.5},e.customUniforms[r.uuid+"_alpha2"]={type:"f",value:.5},e.customUniforms[r.uuid+"_sampler"]={type:"t",value:null},-1==(n=(n=(n=(n=(n=(n=1==r._fragmentChannel?e.fragmentShader:e.fragmentShader2).replace("/* custom_uniforms */","uniform int "+r.uuid+"_mixmode;\n/* custom_uniforms */")).replace("/* custom_uniforms */","uniform int "+r.uuid+"_blendmode;\n/* custom_uniforms */")).replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha1;\n/* custom_uniforms */")).replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha2;\n/* custom_uniforms */")).replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */")).indexOf("vec4 blend ( vec4 src, vec4 dst, int blendmode )")&&(n=n.replace("/* custom_helpers */","\n  vec4 blend ( vec4 src, vec4 dst, int blendmode ) {\n    if ( blendmode ==  1 ) return src + dst;\n    if ( blendmode ==  2 ) return src - dst;\n    if ( blendmode ==  3 ) return src * dst;\n    if ( blendmode ==  4 ) return min(src, dst);\n    if ( blendmode ==  5)  return vec4((src.x == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.x) / src.x)), (src.y == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.y) / src.y)), (src.z == 0.0) ? 0.0 : (1.0 - ((1.0 - dst.z) / src.z)),1.0);\n    if ( blendmode ==  6 ) return (src + dst) - 1.0;\n    if ( blendmode ==  7 ) return max(src, dst);\n    if ( blendmode ==  8 ) return (src + dst) - (src * dst);\n    if ( blendmode ==  9 ) return vec4((src.x == 1.0) ? 1.0 : min(1.0, dst.x / (1.0 - src.x)), (src.y == 1.0) ? 1.0 : min(1.0, dst.y / (1.0 - src.y)), (src.z == 1.0) ? 1.0 : min(1.0, dst.z / (1.0 - src.z)), 1.0);\n    if ( blendmode == 10 ) return src + dst;\n    if ( blendmode == 11 ) return vec4((dst.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - dst.x) * (1.0 - src.x)), (dst.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - dst.y) * (1.0 - src.y)), (dst.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - dst.z) * (1.0 - src.z)), 1.0);\n    if ( blendmode == 12 ) return vec4((src.x <= 0.5) ? (dst.x - (1.0 - 2.0 * src.x) * dst.x * (1.0 - dst.x)) : (((src.x > 0.5) && (dst.x <= 0.25)) ? (dst.x + (2.0 * src.x - 1.0) * (4.0 * dst.x * (4.0 * dst.x + 1.0) * (dst.x - 1.0) + 7.0 * dst.x)) : (dst.x + (2.0 * src.x - 1.0) * (sqrt(dst.x) - dst.x))), (src.y <= 0.5) ? (dst.y - (1.0 - 2.0 * src.y) * dst.y * (1.0 - dst.y)) : (((src.y > 0.5) && (dst.y <= 0.25)) ? (dst.y + (2.0 * src.y - 1.0) * (4.0 * dst.y * (4.0 * dst.y + 1.0) * (dst.y - 1.0) + 7.0 * dst.y)) : (dst.y + (2.0 * src.y - 1.0) * (sqrt(dst.y) - dst.y))), (src.z <= 0.5) ? (dst.z - (1.0 - 2.0 * src.z) * dst.z * (1.0 - dst.z)) : (((src.z > 0.5) && (dst.z <= 0.25)) ? (dst.z + (2.0 * src.z - 1.0) * (4.0 * dst.z * (4.0 * dst.z + 1.0) * (dst.z - 1.0) + 7.0 * dst.z)) : (dst.z + (2.0 * src.z - 1.0) * (sqrt(dst.z) - dst.z))), 1.0);\n    if ( blendmode == 13 ) return vec4((src.x <= 0.5) ? (2.0 * src.x * dst.x) : (1.0 - 2.0 * (1.0 - src.x) * (1.0 - dst.x)), (src.y <= 0.5) ? (2.0 * src.y * dst.y) : (1.0 - 2.0 * (1.0 - src.y) * (1.0 - dst.y)), (src.z <= 0.5) ? (2.0 * src.z * dst.z) : (1.0 - 2.0 * (1.0 - src.z) * (1.0 - dst.z)), 1.0);\n    if ( blendmode == 14 ) return vec4((src.x <= 0.5) ? (1.0 - (1.0 - dst.x) / (2.0 * src.x)) : (dst.x / (2.0 * (1.0 - src.x))), (src.y <= 0.5) ? (1.0 - (1.0 - dst.y) / (2.0 * src.y)) : (dst.y / (2.0 * (1.0 - src.y))), (src.z <= 0.5) ? (1.0 - (1.0 - dst.z) / (2.0 * src.z)) : (dst.z / (2.0 * (1.0 - src.z))),1.0);\n    if ( blendmode == 15 ) return 2.0 * src + dst - 1.0;\n    if ( blendmode == 16 ) return vec4((src.x > 0.5) ? max(dst.x, 2.0 * (src.x - 0.5)) : min(dst.x, 2.0 * src.x), (src.x > 0.5) ? max(dst.y, 2.0 * (src.y - 0.5)) : min(dst.y, 2.0 * src.y), (src.z > 0.5) ? max(dst.z, 2.0 * (src.z - 0.5)) : min(dst.z, 2.0 * src.z),1.0);\n    if ( blendmode == 17 ) return abs(dst - src);\n    if ( blendmode == 18 ) return src + dst - 2.0 * src * dst;\n    return src + dst;\n  }\n  /* custom_helpers */\n  ")),n=n.replace("/* custom_main */",f),1==r._fragmentChannel?e.fragmentShader=n:e.fragmentShader2=n};var v=(new Date).getTime(),g=0,p=0,h=0,_="b",y=0;r.update=function(){if(r.autoFade&&(c=i(),g=((new Date).getTime()-v)/1e3,r.pod(Math.sin(g*Math.PI*c*a/60)/2+.5)),r.fading){var e=(new Date).getTime(),n=(p=h-e)/y;"b"==_&&(n=Math.abs(n-1)),n<0&&(n=0),n>1&&(n=1),r.pod(n),p<0&&(r.fading=!1,n=Math.round(n),r.pod(n))}},r.render=function(){return u},r.alpha1=function(){return t},r.alpha2=function(){return o},r.mixMode=function(e){return null!=e&&(s=e),s},r.blendMode=function(n){return null!=n&&(m=n,e.customUniforms[r.uuid+"_blendmode"].value=m),r.pod(r.pod()),m},r.pod=function(n){return null!=n&&(u=n,1==s&&(t=u,o=1-u),2==s&&(t=Math.round(u),o=Math.round(1-u)),3==s&&((t=2*u)>1&&(t=1),(o=2-2*u)>1&&(o=1)),4==s&&(t=2*u,o=2-2*u),5==s&&((t=2*u)>1&&(t=1),(o=2-2*u)>1&&(o=1),t+=.36,o+=.36),6==s&&(t=1,o=0),7==s&&(t=0,o=1),8==s&&(t=.5,o=.5),9==s&&(t=1,o=1),10==s&&(t=u,o=1),11==s&&(t=1,o=u),e.customUniforms[r.uuid+"_alpha1"].value=t,e.customUniforms[r.uuid+"_alpha2"].value=o),u},r.bpm=function(e){return null!=e&&(c=e),c},r.bpmMod=function(e){return null!=e&&(a=e),a},r.bindBpm=function(e){i=e},r.setAutoFade=function(e){r.autoFade=e},r.fade=function(e){r.pod();r.fading=!0;var n=(new Date).getTime();h=n+e,_=r.pod()>.5?"a":"b",console.log("fadeTo",_,h,n,e),y=e}}}},Monitor=class{static function_list(){return[]}static help(){return"ownoes"}constructor(e,n){var r=this;null!=e&&(null==n.uuid?r.uuid="Monitor_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,r.renderer=e,r.source=n.source,e.add(r),r.type="Module",r.internal_renderer=null,r.init=function(){r.internal_renderer=new GlRenderer(n),r.internal_renderer.fragmentShader=r.renderer.fragmentShader,r.internal_renderer.vertexShader=r.renderer.vertexShader,r.internal_renderer.customUniforms=r.renderer.customUniforms,r.internal_renderer.customDefines=r.renderer.customDefines;new Output(r.internal_renderer,r.source);r.internal_renderer.init(),r.internal_renderer.render()},r.update=function(){})}};function Output(e,n,r){this.uuid="Output_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),this.type="Module",e.add(this);var t=n,o=r;this.init=function(){e.fragmentShader=e.fragmentShader.replace("/* custom_main */","\n  gl_FragColor = vec4( "+t.uuid+"_output );\n"),r&&(console.log("Output. Has 2nd source."),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */","\n  gl_FragColor = vec4( "+o.uuid+"_output );\n"))},this.update=function(){}}function Switcher(e,n){var r=this;r.uuid="Switcher_"+(4294967296*(1+Math.random())|0).toString(16).substring(1),r.type="Module",e.add(r),r.sources=[n.source1,n.source2],r.active_source=0,r.init=function(){console.log("Switcher",r.uuid,r.sources),e.customUniforms[r.uuid+"_active_source"]={type:"i",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform int "+r.uuid+"_active_source;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+r.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_helpers */","\nvec4 get_source_"+r.uuid+" ( int active_source, vec4 src1, vec4 src2 ) {\n  if ( active_source ==  0 ) return src1;  if ( active_source ==  1 ) return src2;}\n/* custom_helpers */\n"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+r.uuid+"_output = get_source_"+r.uuid+"("+r.uuid+"_active_source, "+r.sources[0].uuid+"_output, "+r.sources[1].uuid+"_output );\n  /* custom_main */")},r.update=function(){},r.render=function(){return r.sources[r.active_source]},r.doSwitch=function(n){return null==n?0==r.active_source?r.active_source=1:r.active_source=0:0!=n&&1!=n?console.log(r.uuid,n,"not allowed"):r.active_source=n,e.customUniforms[r.uuid+"_active_source"]={type:"i",value:r.active_source},r.active_source}}var Source=class{constructor(e,n){this.type="Source",this.function_list=[["JUMP","method","jump"]],this.init=function(){},this.update=function(){},this.render=function(){},this.start=function(){},this.src=function(e){},this.play=function(){},this.pause=function(){},this.paused=function(){},this.currentFrame=function(e){},this.duration=function(){},this.jump=function(){}}};function FlexSource(e,n){var r=this,t=1024;null==n.uuid?r.uuid="FlexSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,null==n.fragmentChannel?r._fragmentChannel=1:r._fragmentChannel=n.fragmentChannel;n.texture_size&&(console.log("texture size now is: ",n.texture_size),t=n.texture_size),n.elementId?r.elementId=n.elementId:r.elementId="monitor_1",r.currentSrc="https://virtualmixproject.com/video/placeholder.mp4",r.type="FlexSource",r.bypass=!0,r.currentSrc=n.src;let o=n.src.split(".").pop();console.log("FlexSource. ext",o),"mp4"==o?r.type2="Video":"png"==o||"jpg"==o||"gif"==o?r.type2="Image":console.log("Unknown Source:",n.src);var u,c,a,i,s=128;r.bpmFollow=!1,r.fading=!1;e.add(r),r.init=function(){console.log("init Flex video source",r.uuid),(c=document.createElement("video")).setAttribute("crossorigin","anonymous"),c.setAttribute("playsinline",!0),c.playsinline=!0,c.preload="auto",c.muted=!0,c.poster="https://virtualmixproject.com/gif/telephone-pole-wire-tennis-shoes.jpg",null==n.src?c.src=r.currentSrc:c.src=n.src,console.log("loaded source: ",c.src),c.height=t,c.width=t,c.volume=0,c.loop=!0,c.load(),r.firstplay=!1,c.addEventListener("loadedmetadata",function(e){var n=this.videoWidth,r=this.videoHeight;console.log("WWWWW video width: ",n,r)},!1);var o=setInterval(function(){if(4==c.readyState){var e=Math.random()*c.duration;c.play(),r.firstplay=!0,console.log(r.uuid,"First Play; ",e),clearInterval(o)}},400);function s(){r.firstplay=!0,document.body.removeEventListener("click",s),document.body.removeEventListener("touchstart",s),console.log("first touch was denied")}document.body.addEventListener("click",s),document.body.addEventListener("touchstart",s),(u=document.getElementById(r.elementId)).width=t,u.height=t,a=u.getContext("2d"),(i=new THREE.Texture(u)).wrapS=THREE.RepeatWrapping,i.wrapT=THREE.RepeatWrapping,e.customUniforms[r.uuid]={type:"t",value:i},e.customUniforms[r.uuid+"_alpha"]={type:"f",value:1},e.customUniforms[r.uuid+"_uvmap"]={type:"v2",value:new THREE.Vector2(1,1)},1==r._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+r.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec2 "+r.uuid+"_uvmap;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */",`\n        vec4 ${r.uuid+"_output"} = ( texture2D( ${r.uuid}, vUv * ${r.uuid+"_uvmap"} ).rgba * ${r.uuid+"_alpha"} );\n        /* custom_main */\n        `)):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform sampler2D "+r.uuid+";\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec2 "+r.uuid+"_uvmap;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */",`\n        vec4 ${r.uuid+"_output"} = ( texture2D( ${r.uuid}, vUv * ${r.uuid+"_uvmap"} ).rgba * ${r.uuid+"_alpha"} );\n        /* custom_main */\n        `)),r.video=c,r.canvas=u,window.image_source=new Image,gifElement=document.createElement("img"),gifElement.setAttribute("id","gif_"+r.uuid),gifElement.setAttribute("rel:auto_play","1"),console.log(r.uuid," Load",r.currentSrc,"..."),r.newImg=new Image,r.newImg.onload=function(){var e=r.newImg.height,n=r.newImg.width;r.imageWidth=n,r.imageHeight=e},r.newImg.src=r.currentSrc,console.log("FlexSource/Image Loaded First source!",r.currentSrc,"!"),r.bypass=!1};r.update=function(){let e=4/3;"Video"==r.type2&&c.videoWidth&&(e=c.videoWidth/c.videoHeight),"Image"==r.type2&&r.imageWidth&&(e=r.imageWidth/r.imageHeight);let n=t/(16/9/e),o=(t-n)/2;if(!(r.bypass=!1)){if("Video"==r.type2&&(c&&c.readyState.readyState===c.HAVE_ENOUGH_DATA&&c.seeking,a.drawImage(c,o,0,n,t),i&&(i.needsUpdate=!0)),"Image"==r.type2)try{a.clearRect(0,0,1024,1024),a.drawImage(r.newImg,o,0,n,1024),i&&(i.needsUpdate=!0)}catch(e){}if(r.bpmFollow){s=s,d=((new Date).getTime()-l)/1e3;let e=Math.sin(d*Math.PI*s*1/60)/2+.5;c.currentTime=e}}},r.render=function(){return i},r.src=function(e){if(null==e)return currentSrc;try{r.currentSrc=e,console.log("FlexSource set",r.currentSrc)}catch(e){return void console.log("FlexSource returned empty promise, retrying ...")}let t=e.split(".").pop();console.log("FlexSource. ext",t),"mp4"==t?r.type2="Video":"png"==t||"jpg"==t?r.type2="Image":console.log("Unknown Source:",n.src),"Video"==r.type2&&(c.src=e,c.play()),"Image"==r.type2&&(console.log("load new src: ",e),r.currentSrc=e,r.newImg.src=r.currentSrc),i&&(i.needsUpdate=!0)},r.play=function(){return c.play()},r.pause=function(){return c.pause()},r.paused=function(){return c.paused},r.currentTime=function(e){return void 0===e?c.currentTime:(console.log("set time",e),c.currentTime=e,e)},r.duration=function(){return c.duration},r.setUVMap=function(n,t){e.customUniforms[r.uuid+"_uvmap"].value=new THREE.Vector2(n,t)},r.setUVMapMod=function(n,t){console.log(e.customUniforms),e.customUniforms[r.uuid+"_uvmap_mod"].value=new THREE.Vector2(n,t)},r.alpha=function(n){if(null==n)return e.customUniforms[r.uuid+"_alpha"].value;e.customUniforms[r.uuid+"_alpha"].value=n},r.jump=function(e){if(4==c.readyState){if(null==e||isNaN(e))try{var n=Math.floor(Math.random()*c.buffered.end(0));console.log("jump to ",n),c.currentTime=n}catch(e){console.warn("video jump prevented a race error",e),c.currentTime=0}else c.currentTime=e;return c.currentTime}console.warn("Not enough data for jumping through video...")};var l=(new Date).getTime(),d=0;r.setBpmFollow=function(e){r.bpmFollow=e}}function GifSource(e,n){var r,t,o,u,c,a=this;null==n.uuid?a.uuid="GifSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):a.uuid=n.uuid,null==n.fragmentChannel?a._fragmentChannel=1:a._fragmentChannel=n.fragmentChannel,a.type="GifSource",a.bypass=!0,e.add(a),null==n.src?a.currentSrc="https://virtualmixerproject.com/gif/a443ae90a963a657e12737c466ddff95.gif":a.currentSrc=n.src,n.elementId?a.elementId=n.elementId:a.elementId="monitor_1";a.init=function(){(r=document.getElementById(a.elementId)).width=1024,r.height=1024,o=r.getContext("2d"),u=new THREE.Texture(r),e.customUniforms[a.uuid]={type:"t",value:u},e.customUniforms[a.uuid+"_alpha"]={type:"f",value:1},1==a._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+a.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+a.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+a.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+a.uuid+"_output = ( texture2D( "+a.uuid+", vUv ).rgba * "+a.uuid+"_alpha );\n  /* custom_main */")):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform sampler2D "+a.uuid+";\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec4 "+a.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+a.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */","vec4 "+a.uuid+"_output = ( texture2D( "+a.uuid+", vUv ).rgba * "+a.uuid+"_alpha );\n  /* custom_main */")),a.gif=c,a.canvas=r,window.image_source=new Image,(t=document.createElement("img")).setAttribute("id","gif_"+a.uuid),t.setAttribute("rel:auto_play","1"),(c=new SuperGif({gif:t,c_w:"1024px",c_h:"576px"})).draw_while_loading=!0,console.log(a.uuid," Load",a.currentSrc,"..."),a.newImg=new Image,a.newImg.onload=function(){var e=a.newImg.height,n=a.newImg.width;a.imageWidth=n,a.imageHeight=e},a.newImg.src=a.currentSrc,c.load_url(a.currentSrc,function(){console.log("play initial source"),c.play()}),console.log("Gifsource Loaded First source!",a.currentSrc,"!"),a.bypass=!1};var i=0;a.update=function(){let e=4/3;a.imageWidth&&(e=a.imageWidth/a.imageHeight);let n=1024/(16/9/e),r=(1024-n)/2;try{i%6==0&&(o.clearRect(0,0,1024,1024),o.drawImage(c.get_canvas(),r,0,n,1024),u&&(u.needsUpdate=!0)),i++}catch(e){}},a.render=function(){return u},a.src=function(e){if(null==e)return a.currentSrc;console.log("load new src: ",e),a.currentSrc=e,c.pause(),c.load_url(e,function(){console.log("play gif",e),c.play()})},a.play=function(){return c.play()},a.pause=function(){return c.pause()},a.paused=function(){return!c.get_playing()},a.currentFrame=function(e){return void 0===e?c.get_current_frame():(c.move_to(e),e)},a.duration=function(){return c.get_length()}}function ImageSource(e,n){var r,t,o,u,c=this;null==n.uuid?c.uuid="ImageSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):c.uuid=n.uuid,null==n.fragmentChannel?c._fragmentChannel=1:c._fragmentChannel=n.fragmentChannel,c.type="ImageSource",c.bypass=!0,e.add(c),null==n.src?c.currentSrc="https://virtualmixerproject.com/gif/a443ae90a963a657e12737c466ddff95.gif":c.currentSrc=n.src,n.elementId?c.elementId=n.elementId:c.elementId="monitor_1";c.init=function(){(r=document.getElementById(c.elementId)).width=1024,r.height=1024,o=r.getContext("2d"),u=new THREE.Texture(r),e.customUniforms[c.uuid]={type:"t",value:u},e.customUniforms[c.uuid+"_alpha"]={type:"f",value:1},1==c._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */")):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec4 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */")),c.canvas=r,window.image_source=new Image,(t=document.createElement("img")).setAttribute("id","gif_"+c.uuid),t.setAttribute("rel:auto_play","1"),console.log(c.uuid," Load",c.currentSrc,"..."),c.newImg=new Image,c.newImg.onload=function(){var e=c.newImg.height,n=c.newImg.width;c.imageWidth=n,c.imageHeight=e},c.newImg.src=c.currentSrc,console.log("ImageSource Loaded First source!",c.currentSrc,"!"),c.bypass=!1};c.update=function(){let e=4/3;c.imageWidth&&(e=c.imageWidth/c.imageHeight);let n=1024/(16/9/e),r=(1024-n)/2;try{o.clearRect(0,0,1024,1024),o.drawImage(c.newImg,r,0,n,1024),u&&(u.needsUpdate=!0)}catch(e){}},c.render=function(){return u},c.src=function(e){if(null==e)return c.currentSrc;console.log("load new src: ",e),c.currentSrc=e},c.play=function(){return null},c.pause=function(){return null},c.paused=function(){return!0},c.currentFrame=function(e){return 0},c.duration=function(){return 0}}function MultiVideoSource(e,n){var r,t,o,u=this;null==n.uuid?u.uuid="MultiVideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):u.uuid=n.uuid,u.type="MultiVideoSource",u.bypass=!0,e.add(u);u.init=function(){console.log("init video source",u.uuid),videoElement=document.createElement("video"),videoElement.setAttribute("crossorigin","anonymous"),videoElement.muted=!0,null==n.src?videoElement.src="/streamable.com/w0skqb":videoElement.src=n.src,console.log("loaded source: ",videoElement.src),videoElement.height=1024,videoElement.width=1024,videoElement.loop=!0,videoElement.load(),u.firstplay=!1;var c=setInterval(function(){if(4==videoElement.readyState){var e=Math.random()*videoElement.duration;videoElement.currentTime=e,videoElement.play(),u.firstplay=!0,console.log(u.uuid,"First Play; ",e),clearInterval(c)}},400);document.body.addEventListener("click",function(){videoElement.play(),u.firstplay=!0}),videoElement.volume=0,(r=document.createElement("canvas")).width=1024,r.height=1024,t=r.getContext("2d"),o=new THREE.Texture(r),e.customUniforms[u.uuid]={type:"t",value:o},e.customUniforms[u.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+u.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+u.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+u.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+u.uuid+"_output = ( texture2D( "+u.uuid+", vUv ).rgba * "+u.uuid+"_alpha );\n  /* custom_main */"),u.video=videoElement,u.canvas=r,u.bypass=!1},u.update=function(){(u.bypass=!1)||(videoElement.readyState!==videoElement.HAVE_ENOUGH_DATA||videoElement.seeking?(t.clearRect(0,0,1024,1024),u.alpha=0):(t.drawImage(videoElement,0,0,1024,1024),o&&(o.needsUpdate=!0)))},u.render=function(){return o},u.src=function(e){videoElement.src=e;var n=setInterval(function(){4==videoElement.readyState&&(videoElement.play(),console.log(u.uuid,"First Play."),clearInterval(n))},400)},u.play=function(){return videoElement.play()},u.pause=function(){return videoElement.pause()},u.paused=function(){return videoElement.paused},u.currentTime=function(e){return void 0===e?videoElement.currentTime:(console.log("set time",e),videoElement.currentTime=e,e)},u.duration=function(){return videoElement.duration},u.alpha=function(n){if(null==n)return e.customUniforms[u.uuid+"_alpha"].value;e.customUniforms[u.uuid+"_alpha"].value=n},u.jump=function(e){if(null==e||isNaN(e))try{videoElement.currentTime=Math.floor(Math.random()*u.duration())}catch(e){console.log("prevented a race error")}else videoElement.currentTime=e;return videoElement.currentTime}}function SocketSource(e,n){}function SolidSource(e,n){var r,t=this;null==n.uuid?t.uuid="SolidSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):t.uuid=n.uuid,null==n.fragmentChannel?t._fragmentChannel=1:t._fragmentChannel=n.fragmentChannel,t.bypass=!0,e.add(t);var o={r:0,g:0,b:0,a:1};null!=n&&(r=n),t.init=function(){console.log("init solid",r),null!=r.color&&(o=r.color),e.customUniforms[t.uuid+"_color"]={type:"v4",value:new THREE.Vector4(o.r,o.g,o.b,o.a)},1==t._fragmentChannel?_fs=e.fragmentShader:_fs=e.fragmentShader2,_fs=_fs.replace("/* custom_uniforms */","uniform vec4 "+t.uuid+"_color;\n/* custom_uniforms */"),_fs=_fs.replace("/* custom_uniforms */","uniform vec4 "+t.uuid+"_output;\n/* custom_uniforms */"),_fs=_fs.replace("/* custom_main */","vec4 "+t.uuid+"_output = "+t.uuid+"_color;\n  /* custom_main */"),1==t._fragmentChannel?e.fragmentShader=_fs:e.fragmentShader2=_fs},t.update=function(){},t.render=function(){return o},t.color=function(n){return null!=n&&(null==(o=n).a&&(o.a=1),console.log(t.uuid," sets color: ",o),e.customUniforms[t.uuid+"_color"]={type:"v4",value:new THREE.Vector4(o.r,o.g,o.b,o.a)}),o},t.jump=function(e){console.log("no")}}function SVGSource(e,n){}function TextSource(e,n){var r,t,o,u,c=this;null==n.uuid?c.uuid="TextSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):c.uuid=n.uuid,c.type="TextSource",c.bypass=!0,e.add(c);c.init=function(){console.log("init text source",c.uuid),(t=document.createElement("DIV")).innerHTML="<h1> Awaiting text </h1>",t.height=1024,t.width=1024,c.firstplay=!1,r=document.createElement("canvas"),document.body.appendChild(r),r.width=1024,r.height=1024,o=r.getContext("2d"),u=new THREE.CanvasTexture(r),e.customUniforms[c.uuid]={type:"t",value:u},e.customUniforms[c.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec4 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */"),c.divElement=t,c.canvas=r,c.bypass=!1};var a=null;utils.get("/texts/fear_is_the_mind_killer.txt",function(e){a=e,console.log("get text",e)});var i=0,s="",l=0,d=12,m=600,f=300,v=64,g=512;c.update=function(){v*=.99,(c.bypass=!1)||null!=a&&(o.clearRect(0,0,r.width,r.height),o.fillStyle="rgba(60, 60, 60, 0.4)",o.font="604px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),10*bpm.render()+f,m),o.fillStyle="white",o.font=v+"px IMPACT",o.textAlign="center",o.fillText(s.split(".").join(""),g,460),i>d&&(s=a.split(",")[l],d=a.split(",")[l].length*(bpm.bpm/72)+3,++l==a.split(",").length&&(l=0),i=0,m=Math.floor(200*Math.random())+600,f=Math.floor(200*Math.random())+200,g=Math.floor(100*Math.random())+470,v=Math.floor(30*Math.random())+70),i++,u&&(u.needsUpdate=!0))},c.render=function(){return u},c.alpha=function(n){if(null==n)return e.customUniforms[c.uuid+"_alpha"].value;e.customUniforms[c.uuid+"_alpha"].value=n}}function VideoSource(e,n){var r=this,t=1024;null==n.uuid?r.uuid="VideoSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):r.uuid=n.uuid,null==n.fragmentChannel?r._fragmentChannel=1:r._fragmentChannel=n.fragmentChannel;var o,u,c,a;n.texture_size&&(console.log("texture size now is: ",n.texture_size),t=n.texture_size),n.elementId?r.elementId=n.elementId:r.elementId="monitor_1",r.currentSrc="https://virtualmixproject.com/video/placeholder.mp4",r.type="VideoSource",r.bypass=!0;e.add(r),r.init=function(){console.log("init video source",r.uuid),(u=document.createElement("video")).setAttribute("crossorigin","anonymous"),u.setAttribute("playsinline",!0),u.playsinline=!0,u.preload="auto",u.muted=!0,u.poster="https://virtualmixproject.com/gif/telephone-pole-wire-tennis-shoes.jpg",null==n.src?u.src=r.currentSrc:u.src=n.src,console.log("loaded source: ",u.src),u.height=t,u.width=t,u.volume=0,u.loop=!0,u.load(),r.firstplay=!1,u.addEventListener("loadedmetadata",function(e){var n=this.videoWidth,r=this.videoHeight;console.log("WWWWW video width: ",n,r)},!1);var i=setInterval(function(){if(4==u.readyState){var e=Math.random()*u.duration;u.play(),r.firstplay=!0,console.log(r.uuid,"First Play; ",e),clearInterval(i)}},400);function s(){r.firstplay=!0,document.body.removeEventListener("click",s),document.body.removeEventListener("touchstart",s),console.log("first touch was denied")}document.body.addEventListener("click",s),document.body.addEventListener("touchstart",s),(o=document.getElementById(r.elementId)).width=t,o.height=t,c=o.getContext("2d"),(a=new THREE.Texture(o)).wrapS=THREE.RepeatWrapping,a.wrapT=THREE.RepeatWrapping,e.customUniforms[r.uuid]={type:"t",value:a},e.customUniforms[r.uuid+"_alpha"]={type:"f",value:1},e.customUniforms[r.uuid+"_uvmap"]={type:"v2",value:new THREE.Vector2(1,1)},1==r._fragmentChannel?(e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+r.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec2 "+r.uuid+"_uvmap;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */",`\n        vec4 ${r.uuid+"_output"} = ( texture2D( ${r.uuid}, vUv * ${r.uuid+"_uvmap"} ).rgba * ${r.uuid+"_alpha"} );\n        /* custom_main */\n        `)):(e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform sampler2D "+r.uuid+";\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform float "+r.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_uniforms */","uniform vec2 "+r.uuid+"_uvmap;\n/* custom_uniforms */"),e.fragmentShader2=e.fragmentShader2.replace("/* custom_main */",`\n        vec4 ${r.uuid+"_output"} = ( texture2D( ${r.uuid}, vUv * ${r.uuid+"_uvmap"} ).rgba * ${r.uuid+"_alpha"} );\n        /* custom_main */\n        `)),r.video=u,r.canvas=o,r.bypass=!1};r.update=function(){let e=4/3;u.videoWidth&&(e=u.videoWidth/u.videoHeight);let n=t/(16/9/e),o=(t-n)/2;(r.bypass=!1)||(u&&u.readyState.readyState===u.HAVE_ENOUGH_DATA&&u.seeking,c.drawImage(u,o,0,n,t),a&&(a.needsUpdate=!0))},r.render=function(){return a},r.src=function(e){if(null==e)return currentSrc;try{r.currentSrc=e}catch(e){return void console.log("VideoSource returned empty promise, retrying ...")}u.src=e,u.play()},r.play=function(){return u.play()},r.pause=function(){return u.pause()},r.paused=function(){return u.paused},r.currentTime=function(e){return void 0===e?u.currentTime:(console.log("set time",e),u.currentTime=e,e)},r.duration=function(){return u.duration},r.setUVMap=function(n,t){e.customUniforms[r.uuid+"_uvmap"].value=new THREE.Vector2(n,t)},r.setUVMapMod=function(n,t){console.log(e.customUniforms),e.customUniforms[r.uuid+"_uvmap_mod"].value=new THREE.Vector2(n,t)},r.alpha=function(n){if(null==n)return e.customUniforms[r.uuid+"_alpha"].value;e.customUniforms[r.uuid+"_alpha"].value=n},r.jump=function(e){if(4==u.readyState){if(null==e||isNaN(e))try{var n=Math.floor(Math.random()*u.buffered.end(0));console.log("jump to ",n),u.currentTime=n}catch(e){console.warn("video jump prevented a race error",e),u.currentTime=0}else u.currentTime=e;return u.currentTime}console.warn("Not enough data for jumping through video...")}}function WebcamSource(e,n){var r,t,o,u,c=this;null==n.uuid?c.uuid="WebcamSource_"+(4294967296*(1+Math.random())|0).toString(16).substring(1):c.uuid=n.uuid,c.type="WebcamSource",c.bypass=!0,e.add(c);c.init=function(){console.log("init video source",c.uuid),(t=document.createElement("video")).setAttribute("crossorigin","anonymous"),t.height=1024,t.width=1024,t.loop=!0,t.load(),c.firstplay=!1;navigator.mediaDevices.getUserMedia({audio:!1,video:{width:1024,height:1024}}).then(function(e){t.srcObject=e,t.onloadedmetadata=function(e){t.play()}}).catch(function(e){console.log(e.name+": "+e.message)});var n=setInterval(function(){if(4==t.readyState){var e=Math.random()*t.duration;t.play(),c.firstplay=!0,console.log(c.uuid,"First Play; ",e),clearInterval(n)}},400);document.body.addEventListener("click",function(){t.play(),c.firstplay=!0}),t.volume=0,(r=document.createElement("canvas")).width=1024,r.height=1024,o=r.getContext("2d"),u=new THREE.Texture(r),e.customUniforms[c.uuid]={type:"t",value:u},e.customUniforms[c.uuid+"_alpha"]={type:"f",value:1},e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform sampler2D "+c.uuid+";\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform vec3 "+c.uuid+"_output;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_uniforms */","uniform float "+c.uuid+"_alpha;\n/* custom_uniforms */"),e.fragmentShader=e.fragmentShader.replace("/* custom_main */","vec4 "+c.uuid+"_output = ( texture2D( "+c.uuid+", vUv ).rgba * "+c.uuid+"_alpha );\n  /* custom_main */"),c.video=t,c.canvas=r,c.bypass=!1},c.update=function(){(c.bypass=!1)||(t.readyState!==t.HAVE_ENOUGH_DATA||t.seeking?(o.clearRect(0,0,1024,1024),c.alpha=0):(o.drawImage(t,0,0,1024,1024),u&&(u.needsUpdate=!0)))},c.render=function(){return u},c.play=function(){return t.play()},c.pause=function(){return t.pause()},c.paused=function(){return t.paused},c.duration=function(){return t.duration},c.alpha=function(n){if(null==n)return e.customUniforms[c.uuid+"_alpha"].value;e.customUniforms[c.uuid+"_alpha"].value=n}}FlexSource.prototype=new Source,FlexSource.constructor=FlexSource,GifSource.prototype=new Source,GifSource.constructor=GifSource,ImageSource.prototype=new Source,ImageSource.constructor=ImageSource,MultiVideoSource.prototype=new Source,MultiVideoSource.constructor=MultiVideoSource,SocketSource.prototype=new Source,SocketSource.constructor=SocketSource,SolidSource.prototype=new Source,SolidSource.constructor=SolidSource,SVGSource.prototype=new Source,SVGSource.constructor=SVGSource,TextSource.prototype=new Source,TextSource.constructor=TextSource,VideoSource.prototype=new Source,VideoSource.constructor=VideoSource,WebcamSource.prototype=new Source,WebcamSource.constructor=WebcamSource;